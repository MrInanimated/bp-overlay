// ==UserScript==
// @name         BombParty Overlay
// @version      1.4.8
// @description  Overlay + Utilities for BombParty!
// @icon         https://raw.githubusercontent.com/MrInanimated/bp-overlay/master/dist/icon.png
// @icon64       https://raw.githubusercontent.com/MrInanimated/bp-overlay/master/dist/icon64.png
// @downloadURL  https://github.com/MrInanimated/bp-overlay/raw/master/dist/bpoverlay.user.js
// @author       MrInanimated and Skandalabrandur
// @match        http://bombparty.sparklinlabs.com/play/*
// @resource     twitch_global http://twitchemotes.com/global.json
// @resource     twitch_subscriber http://twitchemotes.com/subscriber.json
// @resource     autoScrollOn https://raw.githubusercontent.com/MrInanimated/bp-overlay/master/dist/chatdown.png
// @resource     autoScrollOff https://raw.githubusercontent.com/MrInanimated/bp-overlay/master/dist/chatdownoff.png
// @resource     autoFocusOn https://raw.githubusercontent.com/MrInanimated/bp-overlay/master/dist/focusOn.png
// @resource     autoFocusOff https://raw.githubusercontent.com/MrInanimated/bp-overlay/master/dist/focusOff.png
// @resource     dragOff https://raw.githubusercontent.com/MrInanimated/bp-overlay/master/dist/dragOff.png
// @resource     dragOn https://raw.githubusercontent.com/MrInanimated/bp-overlay/master/dist/dragOn.png
// @resource     hideDeadOn https://raw.githubusercontent.com/MrInanimated/bp-overlay/master/dist/hideDeadOn.png
// @resource     hideDeadOff https://raw.githubusercontent.com/MrInanimated/bp-overlay/master/dist/hideDeadOff.png
// @grant        GM_getResourceText
// @grant        GM_getResourceURL
// @grant        GM_getValue
// @grant        GM_setValue
// @grant        GM_xmlhttpRequest
// ==/UserScript==


// Un-minified JS, available at https://github.com/MrInanimated/bp-overlay/blob/master/dist/bpoverlay.user.js
function addJQuery(e){var t=document.createElement("script");t.setAttribute("src","//ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"),t.addEventListener("load",function(){var t=document.createElement("script");t.textContent="window.jQ=jQuery.noConflict(true);("+e.toString()+")();",document.body.appendChild(t)},!1),document.body.appendChild(t)}function main(){}addJQuery(main);var tg=GM_getResourceText("twitch_global"),ts=GM_getResourceText("twitch_subscriber"),te=document.createElement("script");te.setAttribute("type","application/javascript"),te.textContent="var twitch_global = "+tg+";var twitch_subscriber = "+ts+';var bpImgUrls = {	autoScrollOn : "'+GM_getResourceURL("autoScrollOn")+'",	autoScrollOff : "'+GM_getResourceURL("autoScrollOff")+'",	autoFocusOn : "'+GM_getResourceURL("autoFocusOn")+'",	autoFocusOff : "'+GM_getResourceURL("autoFocusOff")+'",	dragOff : "'+GM_getResourceURL("dragOff")+'",	dragOn : "'+GM_getResourceURL("dragOn")+'",	hideDeadOn : "'+GM_getResourceURL("hideDeadOn")+'",	hideDeadOff : "'+GM_getResourceURL("hideDeadOff")+'",};',document.body.appendChild(te),document.body.removeChild(te);var source=function(){if(window.hasOwnProperty("BPOverlayHasRun"));else{window.BPOverlayHasRun=!0;var main=function(){function resize(){if(bpOverlay.dragboxHasBeenCreated){var e=window.innerHeight,t=window.innerWidth,a=document.getElementById("infoBox"),n=a.clientWidth,o=a.clientHeight,r=document.getElementById("dragonDrop"),i=parseInt(r.style.left),s=parseInt(r.style.top);n+i>t&&(r.style.left=t-n+"px"),0>s?r.style.top="0px":o+s>e&&(r.style.top=e-o+"px")}}function drag_start(e){var t=window.getComputedStyle(e.target,null);e.dataTransfer.setData("text/plain",parseInt(t.getPropertyValue("left"),10)-e.clientX+","+(parseInt(t.getPropertyValue("top"),10)-e.clientY))}function drag_over(e){return e.preventDefault(),!1}function drop(e){var t=e.dataTransfer.getData("text/plain").split(","),a=document.getElementById("dragonDrop"),n=e.clientX+parseInt(t[0],10),o=e.clientY+parseInt(t[1],10),r=window.innerHeight,i=window.innerWidth,s=document.getElementById("infoBox").clientHeight,l=document.getElementById("infoBox").clientWidth;return a.style.left=0>n?"0px":n+l>i?i-l+"px":n+"px",a.style.top=0>o?"0px":o+s>r?r-s+"px":o+"px",e.preventDefault(),!1}if(!(window.hasOwnProperty("channel")&&channel.socket&&channel.data&&channel.appendToChat&&channel.socket.listeners("chatMessage").length&&channel.socket.listeners("setActivePlayerIndex").length&&channel.socket.listeners("winWord").length&&channel.socket.listeners("setPlayerLives").length&&channel.socket.listeners("setPlayerState").length&&channel.socket.listeners("endGame").length&&window.hasOwnProperty("JST")&&JST["nuclearnode/chatMessage"]&&document.getElementById("Sidebar")&&document.getElementById("ChatLog")))return console.log("Everything's not loaded yet, trying again in a second..."),void setTimeout(main,1e3);!function(e,t){"function"==typeof define&&define.amd?define([],function(){return e.returnExportsGlobal=t()}):"object"==typeof exports?module.exports=t():e.Autolinker=t()}(this,function(){var e=function(t){e.Util.assign(this,t),this.matchValidator=new e.MatchValidator};return e.prototype={constructor:e,urls:!0,email:!0,twitter:!0,newWindow:!0,stripPrefix:!0,className:"",htmlCharacterEntitiesRegex:/(&nbsp;|&#160;|&lt;|&#60;|&gt;|&#62;)/gi,matcherRegex:function(){var e=/(^|[^\w])@(\w{1,15})/,t=/(?:[\-;:&=\+\$,\w\.]+@)/,a=/(?:[A-Za-z][-.+A-Za-z0-9]+:(?![A-Za-z][-.+A-Za-z0-9]+:\/\/)(?!\d+\/?)(?:\/\/)?)/,n=/(?:www\.)/,o=/[A-Za-z0-9\.\-]*[A-Za-z0-9\-]/,r=/\.(?:international|construction|contractors|enterprises|photography|productions|foundation|immobilien|industries|management|properties|technology|christmas|community|directory|education|equipment|institute|marketing|solutions|vacations|bargains|boutique|builders|catering|cleaning|clothing|computer|democrat|diamonds|graphics|holdings|lighting|partners|plumbing|supplies|training|ventures|academy|careers|company|cruises|domains|exposed|flights|florist|gallery|guitars|holiday|kitchen|neustar|okinawa|recipes|rentals|reviews|shiksha|singles|support|systems|agency|berlin|camera|center|coffee|condos|dating|estate|events|expert|futbol|kaufen|luxury|maison|monash|museum|nagoya|photos|repair|report|social|supply|tattoo|tienda|travel|viajes|villas|vision|voting|voyage|actor|build|cards|cheap|codes|dance|email|glass|house|mango|ninja|parts|photo|shoes|solar|today|tokyo|tools|watch|works|aero|arpa|asia|best|bike|blue|buzz|camp|club|cool|coop|farm|fish|gift|guru|info|jobs|kiwi|kred|land|limo|link|menu|mobi|moda|name|pics|pink|post|qpon|rich|ruhr|sexy|tips|vote|voto|wang|wien|wiki|zone|bar|bid|biz|cab|cat|ceo|com|edu|gov|int|kim|mil|net|onl|org|pro|pub|red|tel|uno|wed|xxx|xyz|ac|ad|ae|af|ag|ai|al|am|an|ao|aq|ar|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cu|cv|cw|cx|cy|cz|de|dj|dk|dm|do|dz|ec|ee|eg|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mk|ml|mm|mn|mo|mp|mq|mr|ms|mt|mu|mv|mw|mx|my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|ps|pt|pw|py|qa|re|ro|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|sk|sl|sm|sn|so|sr|st|su|sv|sx|sy|sz|tc|td|tf|tg|th|tj|tk|tl|tm|tn|to|tp|tr|tt|tv|tw|tz|ua|ug|uk|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|za|zm|zw)\b/,i=/[\-A-Za-z0-9+&@#\/%=~_()|'$*\[\]?!:,.;]*[\-A-Za-z0-9+&@#\/%=~_()|'$*\[\]]/;return new RegExp(["(",e.source,")","|","(",t.source,o.source,r.source,")","|","(","(?:","(",a.source,o.source,")","|","(?:","(.?//)?",n.source,o.source,")","|","(?:","(.?//)?",o.source,r.source,")",")","(?:"+i.source+")?",")"].join(""),"gi")}(),charBeforeProtocolRelMatchRegex:/^(.)?\/\//,link:function(t){var a=this,n=this.getHtmlParser(),o=this.htmlCharacterEntitiesRegex,r=0,i=[];return n.parse(t,{processHtmlNode:function(e,t,a){"a"===t&&(a?r=Math.max(r-1,0):r++),i.push(e)},processTextNode:function(t){if(0===r)for(var n=e.Util.splitAndCapture(t,o),s=0,l=n.length;l>s;s++){var c=n[s],d=a.processTextNode(c);i.push(d)}else i.push(t)}}),i.join("")},getHtmlParser:function(){var t=this.htmlParser;return t||(t=this.htmlParser=new e.HtmlParser),t},getTagBuilder:function(){var t=this.tagBuilder;return t||(t=this.tagBuilder=new e.AnchorTagBuilder({newWindow:this.newWindow,truncate:this.truncate,className:this.className})),t},processTextNode:function(e){var t=this;return e.replace(this.matcherRegex,function(e,a,n,o,r,i,s,l,c){var d=t.processCandidateMatch(e,a,n,o,r,i,s,l,c);if(d){var u=t.createMatchReturnVal(d.match,d.matchStr);return d.prefixStr+u+d.suffixStr}return e})},processCandidateMatch:function(t,a,n,o,r,i,s,l,c){var d,u=l||c,p="",m="";if(a&&!this.twitter||r&&!this.email||i&&!this.urls||!this.matchValidator.isValidMatch(i,s,u))return null;if(this.matchHasUnbalancedClosingParen(t)&&(t=t.substr(0,t.length-1),m=")"),r)d=new e.match.Email({matchedText:t,email:r});else if(a)n&&(p=n,t=t.slice(1)),d=new e.match.Twitter({matchedText:t,twitterHandle:o});else{if(u){var h=u.match(this.charBeforeProtocolRelMatchRegex)[1]||"";h&&(p=h,t=t.slice(1))}d=new e.match.Url({matchedText:t,url:t,protocolUrlMatch:!!s,protocolRelativeMatch:!!u,stripPrefix:this.stripPrefix})}return{prefixStr:p,suffixStr:m,matchStr:t,match:d}},matchHasUnbalancedClosingParen:function(e){var t=e.charAt(e.length-1);if(")"===t){var a=e.match(/\(/g),n=e.match(/\)/g),o=a&&a.length||0,r=n&&n.length||0;if(r>o)return!0}return!1},createMatchReturnVal:function(t,a){var n;if(this.replaceFn&&(n=this.replaceFn.call(this,this,t)),"string"==typeof n)return n;if(n===!1)return a;if(n instanceof e.HtmlTag)return n.toString();var o=this.getTagBuilder(),r=o.build(t);return r.toString()}},e.link=function(t,a){var n=new e(a);return n.link(t)},e.match={},e.Util={abstractMethod:function(){throw"abstract"},assign:function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a]);return e},extend:function(t,a){var n=t.prototype,o=function(){};o.prototype=n;var r;r=a.hasOwnProperty("constructor")?a.constructor:function(){n.constructor.apply(this,arguments)};var i=r.prototype=new o;return i.constructor=r,i.superclass=n,delete a.constructor,e.Util.assign(i,a),r},ellipsis:function(e,t,a){return e.length>t&&(a=null==a?"..":a,e=e.substring(0,t-a.length)+a),e},indexOf:function(e,t){if(Array.prototype.indexOf)return e.indexOf(t);for(var a=0,n=e.length;n>a;a++)if(e[a]===t)return a;return-1},splitAndCapture:function(e,t){if(!t.global)throw new Error("`splitRegex` must have the 'g' flag set");for(var a,n=[],o=0;a=t.exec(e);)n.push(e.substring(o,a.index)),n.push(a[0]),o=a.index+a[0].length;return n.push(e.substring(o)),n}},e.HtmlParser=e.Util.extend(Object,{htmlRegex:function(){var e=/[0-9a-zA-Z][0-9a-zA-Z:]*/,t=/[^\s\0"'>\/=\x01-\x1F\x7F]+/,a=/(?:".*?"|'.*?'|[^'"=<>`\s]+)/,n=t.source+"(?:\\s*=\\s*"+a.source+")?";return new RegExp(["(?:","<(!DOCTYPE)","(?:","\\s+","(?:",n,"|",a.source+")",")*",">",")","|","(?:","<(/)?","("+e.source+")","(?:","\\s+",n,")*","\\s*/?",">",")"].join(""),"gi")}(),parse:function(e,t){t=t||{};for(var a,n=t.processHtmlNode||function(){},o=t.processTextNode||function(){},r=this.htmlRegex,i=0;null!==(a=r.exec(e));){var s=a[0],l=a[1]||a[3],c=!!a[2],d=e.substring(i,a.index);d&&o(d),n(s,l.toLowerCase(),c),i=a.index+s.length}if(i<e.length){var u=e.substring(i);u&&o(u)}}}),e.HtmlTag=e.Util.extend(Object,{whitespaceRegex:/\s+/,constructor:function(t){e.Util.assign(this,t),this.innerHtml=this.innerHtml||this.innerHTML},setTagName:function(e){return this.tagName=e,this},getTagName:function(){return this.tagName||""},setAttr:function(e,t){var a=this.getAttrs();return a[e]=t,this},getAttr:function(e){return this.getAttrs()[e]},setAttrs:function(t){var a=this.getAttrs();return e.Util.assign(a,t),this},getAttrs:function(){return this.attrs||(this.attrs={})},setClass:function(e){return this.setAttr("class",e)},addClass:function(t){for(var a,n=this.getClass(),o=this.whitespaceRegex,r=e.Util.indexOf,i=n?n.split(o):[],s=t.split(o);a=s.shift();)-1===r(i,a)&&i.push(a);return this.getAttrs()["class"]=i.join(" "),this},removeClass:function(t){for(var a,n=this.getClass(),o=this.whitespaceRegex,r=e.Util.indexOf,i=n?n.split(o):[],s=t.split(o);i.length&&(a=s.shift());){var l=r(i,a);-1!==l&&i.splice(l,1)}return this.getAttrs()["class"]=i.join(" "),this},getClass:function(){return this.getAttrs()["class"]||""},hasClass:function(e){return-1!==(" "+this.getClass()+" ").indexOf(" "+e+" ")},setInnerHtml:function(e){return this.innerHtml=e,this},getInnerHtml:function(){return this.innerHtml||""},toString:function(){var e=this.getTagName(),t=this.buildAttrsStr();return t=t?" "+t:"",["<",e,t,">",this.getInnerHtml(),"</",e,">"].join("")},buildAttrsStr:function(){if(!this.attrs)return"";var e=this.getAttrs(),t=[];for(var a in e)e.hasOwnProperty(a)&&t.push(a+'="'+e[a]+'"');return t.join(" ")}}),e.MatchValidator=e.Util.extend(Object,{invalidProtocolRelMatchRegex:/^[\w]\/\//,hasFullProtocolRegex:/^[A-Za-z][-.+A-Za-z0-9]+:\/\//,uriSchemeRegex:/^[A-Za-z][-.+A-Za-z0-9]+:/,hasWordCharAfterProtocolRegex:/:[^\s]*?[A-Za-z]/,isValidMatch:function(e,t,a){return t&&!this.isValidUriScheme(t)||this.urlMatchDoesNotHaveProtocolOrDot(e,t)||this.urlMatchDoesNotHaveAtLeastOneWordChar(e,t)||this.isInvalidProtocolRelativeMatch(a)?!1:!0},isValidUriScheme:function(e){var t=e.match(this.uriSchemeRegex)[0];return"javascript:"!==t&&"vbscript:"!==t},urlMatchDoesNotHaveProtocolOrDot:function(e,t){return!(!e||t&&this.hasFullProtocolRegex.test(t)||-1!==e.indexOf("."))},urlMatchDoesNotHaveAtLeastOneWordChar:function(e,t){return e&&t?!this.hasWordCharAfterProtocolRegex.test(e):!1},isInvalidProtocolRelativeMatch:function(e){return!!e&&this.invalidProtocolRelMatchRegex.test(e)}}),e.AnchorTagBuilder=e.Util.extend(Object,{constructor:function(t){e.Util.assign(this,t)},build:function(t){var a=new e.HtmlTag({tagName:"a",attrs:this.createAttrs(t.getType(),t.getAnchorHref()),innerHtml:this.processAnchorText(t.getAnchorText())});return a},createAttrs:function(e,t){var a={href:t},n=this.createCssClass(e);return n&&(a["class"]=n),this.newWindow&&(a.target="_blank"),a},createCssClass:function(e){var t=this.className;return t?t+" "+t+"-"+e:""},processAnchorText:function(e){return e=this.doTruncate(e)},doTruncate:function(t){return e.Util.ellipsis(t,this.truncate||Number.POSITIVE_INFINITY)}}),e.match.Match=e.Util.extend(Object,{constructor:function(t){e.Util.assign(this,t)},getType:e.Util.abstractMethod,getMatchedText:function(){return this.matchedText},getAnchorHref:e.Util.abstractMethod,getAnchorText:e.Util.abstractMethod}),e.match.Email=e.Util.extend(e.match.Match,{getType:function(){return"email"},getEmail:function(){return this.email},getAnchorHref:function(){return"mailto:"+this.email},getAnchorText:function(){return this.email}}),e.match.Twitter=e.Util.extend(e.match.Match,{getType:function(){return"twitter"},getTwitterHandle:function(){return this.twitterHandle},getAnchorHref:function(){return"https://twitter.com/"+this.twitterHandle},getAnchorText:function(){return"@"+this.twitterHandle}}),e.match.Url=e.Util.extend(e.match.Match,{urlPrefixRegex:/^(https?:\/\/)?(www\.)?/i,protocolRelativeRegex:/^\/\//,protocolPrepended:!1,getType:function(){return"url"},getUrl:function(){var e=this.url;return this.protocolRelativeMatch||this.protocolUrlMatch||this.protocolPrepended||(e=this.url="http://"+e,this.protocolPrepended=!0),e},getAnchorHref:function(){var e=this.getUrl();return e.replace(/&/g,"&")},getAnchorText:function(){var e=this.getUrl();return this.protocolRelativeMatch&&(e=this.stripProtocolRelativePrefix(e)),this.stripPrefix&&(e=this.stripUrlPrefix(e)),e=this.removeTrailingSlash(e)},stripUrlPrefix:function(e){return e.replace(this.urlPrefixRegex,"")},stripProtocolRelativePrefix:function(e){return e.replace(this.protocolRelativeRegex,"")},removeTrailingSlash:function(e){return"/"===e.charAt(e.length-1)&&(e=e.slice(0,-1)),e}}),e});var tran={strings:{en:{timeText:"Elapsed time | ",wordCountText:"Word Count: ",showHideButtonTitle:"Show/Hide dead players.",flipsText:"Flips",flipsTitle:"Lives gained by using all the bonus letters.",uFlipsText:"U-Flips",uFlipsTitle:'Lives gained whilst already at 3 lives, making the "flip" unnecessary',deathsText:"Deaths",deathsTitle:"Lives lost in this game",playersTitle:"Players:",alphaText:"Alpha",alphaTitle:"Which letter this player is on if he was playing alpha roulette. (The number is how many times they have completed the alphabet)",chatDownButtonTitle:"Automatically scroll the chat down whenever there is a new message.",autoFocusButtonTitle:"Automatically focus the chat box after your turn.",dragButtonTitle:"Have the scoreboard be in a draggable container instead.",overlaySettingsButtonTitle:"BombParty Overlay Settings",overlaySettingsText:"Overlay Settings",playerListText:"Current Players",creditsText:"Credits",credits1:"Code Monkey",credits2:"Code Amoeba",credits3:"Frenchifier",creditsAutolinker:"Autolinker",creditsTwitchEmotes:"Twitch Emotes",creditsTextText:"With thanks to the English BombParty community",containerSizeName:"Container Size",containerSizeOptions:{compact:"Compact Size",fitToPlayers:"Fit To Players"},twitchEmotesName:"Twitch Emotes",twitchEmotesOptions:{on:"On",off:"Off"},textAdventureName:"Text Adventure<sup>BETA</sup>",textAdventureOptions:{on:"On",off:"Off"},hardModesName:"Hard Modes",hardModesOptions:{none:"None",rev:"Reverse",jqv:"J/Q/V",az:"Alphabet",xz:"X/Z"},themeName:"Theme<sup>BETA</sup>",themeOptions:{none:"None",xmas:"Christmas",custom:"Custom"},customThemeName:"Custom Theme",particlesName:"Particles",particlesOptions:{high:"High",low:"Low",off:"Off"},notificationsName:"Notifications",notificationVolume:"Notification Volume",notificationOptions:{on:"On",off:"Off"},notificationAlias:"Aliases",notificationAliasTitle:"Custom names that also trigger a notification.",notificationAliasInputTitle:"Write your names one after another separated by semicolons here. e.g. MrInanimated;Inanimated;Animé;Inan",endGameNotification:"Notify when a game ends",endGameNotificationOptions:{on:"On",off:"Off"},alphaRouletteName:"Alpha Roulette Display",alphaRouletteOptions:{on:"On",off:"Off"},jqvText:"That word didn't contain J, Q nor V!",azText:"You are on letter {l} Kappa!",xzText:"That word didn't contain X nor Z!",updateText:"New Update! (2015-02-26)<br />Experimental text-to-speech. See settings.",speechName:"Speech on Chrome<sup>BETA</sup>",speechOptions:{on:"On",off:"Off"},voiceSelect:"Voice",voiceOptions:{us:"US",ukMale:"GB Male",ukFem:"GB Female",fran:"FR"}},fr:{timeText:"Temps Écoulé : ",wordCountText:"Nombre de Mots : ",showHideButtonTitle:"Afficher/Masquer les joueurs morts.",flipsText:"V.R.",flipsTitle:"Vies récupérées en utilisant toutes les lettres bonus",uFlipsText:"V.R.I.",uFlipsTitle:'Vies récupérées inutiles : vies récupérées tandis qu\'on en possède trois, ce qui les rend "inutiles"',deathsText:"Morts",deathsTitle:"Vies perdues dans cette partie",alphaText:"Alpha",alphaTitle:"La lettre à laquelle ce joueur serait si il jouait en mode alphabet. (Le chiffre entre parenthèses est le nombre de fois où il a complété l'alphabet)",playersTitle:"Joueurs :",chatDownButtonTitle:"Forcer le tchat à défiler vers le bas quand il y a un nouveau message.",autoFocusButtonTitle:"Positionner automatiquement le curseur sur le tchat après son tour",dragButtonTitle:"Détacher le tableau des scores.",overlaySettingsButtonTitle:"Paramètres de l'Overlay",overlaySettingsText:"Paramètres",playerListText:"Joueurs connectés",creditsText:"Crédits",credits1:"Code Monkey",credits2:"Code Amoeba",credits3:"Traduction",creditsAutolinker:"Liens automatiques",creditsTwitchEmotes:"Emoticones Twitch",creditsTextText:"Remerciements à la communauté anglaise de BombParty",containerSizeName:"Taille du tableau",containerSizeOptions:{compact:"Compacte",fitToPlayers:"Ajustée selon les joueurs"},twitchEmotesName:"Emoticones Twitch",twitchEmotesOptions:{on:"Marche",off:"Arrêt"},textAdventureName:"Text Adventure<sup>BETA</sup>",textAdventureOptions:{on:"Marche",off:"Arrêt"},hardModesName:"Difficultés supplémentaires",hardModesOptions:{none:"Aucune",rev:"Inversé",jqv:"J/Q/V",az:"Alphabet",xz:"X/Z"},themeName:"Thème<sup>BETA</sup>",themeOptions:{none:"Aucun",xmas:"Noël",custom:"Personnalisé"},customThemeName:"Thème Personnalisé",particlesName:"Particules",particlesOptions:{high:"Elevé",low:"Faible",off:"Désactivé"},notificationsName:"Notifications",notificationVolume:"Volume de Notification",notificationOptions:{on:"Activé",off:"Désactivé"},notificationAlias:"Pseudonymes",notificationAliasTitle:"Noms personnalisés qui déclenchent également une notification.",notificationAliasInputTitle:"Ecrivez vos noms l'un après l'autre, séparés par un point virgule. Par ex. MrInanimated;Inanimated;Animé;Inan",endGameNotification:"Avertit quand une partie se termine",endGameNotificationOptions:{on:"Activé",off:"Désactivé"},alphaRouletteName:"Affichage Mode Alphabet",alphaRouletteOptions:{on:"Activé",off:"Désactivé"},jqvText:"Ce mot ne contient ni J, ni V, ni Q.",azText:"Au tour de la lettre {l} Kappa !",xzText:"Ce mot ne contient ni X, ni Z !",updateText:"Nouvelle mise à jour ! (2015-02-26)<br />Expérimental TTS. Voir paramètres.",speechName:"Vocale sur Chrome<sup>BETA</sup>",speechOptions:{on:"Activé",off:"Désactivé"},voiceSelect:"Voix",voiceOptions:{us:"US",ukMale:"GB Homme",ukFem:"GB Femme",fran:"FR"}}},language:-1!==document.cookie.indexOf("i18next=fr")?"fr":"en",fallback:"en",t:function(accessor){var rStr;try{if(void 0!==(rStr=eval("this.strings."+this.language+"."+accessor)))return rStr}catch(e){if(!(e instanceof TypeError))throw e}try{if(void 0!==(rStr=eval("this.strings."+this.fallback+"."+accessor)))return rStr}catch(e){if(!(e instanceof TypeError))throw e}return accessor}};bpOverlay={playerNames:{},playerAuthId:{},lostLives:{},flips:{},uFlips:{},alpha:{},wordCount:0,startTime:0,timeText:"",dragBoxHasBeenCreated:!1,boxHasBeenCreated:!1,firstRun:!0,prevPlayerNames:{},prevLostLives:{},prevFlips:{},prevUFlips:{},prevTimeText:"",prevWordCount:0,hideDead:!1,dragonDrop:!1,autoScroll:!0,autoFocus:!0,focusNext:!1,twitchOn:!0,markupOn:!0,adventureTextMode:!1,adventureFirstRun:!1,adventureLevels:["A noob","A beginner","A novice","A student of flips","A graduated student of flips","An expert flipper","An incredible flipper","A master flipper","A scrub tier immortal","A near immortal","An immortal","A massive flipping faggot","A strong contender to the 'hang in there kitty'","An immeasurable faggot of flips","A blackhole tier faggot","A legendary immortal faggot flipper","A supermassive faggot with more flips than a herd of dolphins","Silly rabbit. Flips are for kids!","An undefeatable flipping gaylord of +5 anal strength","An ascended immortal queen faggot cockmunch godly overlord of flips","Zip zop zippety boop flip floop","You're now the gayest man on earth","Aren't you fagged out after all that flipping?","A lifesize Johnboat","A lifesize Catboat","The Jesus figure in the underworld of extreme flip fetish","On fliproids!","Why don't you slip into something more comfortable... like a coma?","A divine elder scrub god that manifests himself as fine-cuisine salt","The nicest guy. Didn't expect that did you?","Hungry hungry heart hoarder!","A bird in the hand is worth zemstvo in the quush","You're good. Actually very good. Goddamn","Still going. Holy crap!","Your Anaconda dont want none unless you got equivocations hun","A budding plenipotentiary","Antidisestablishmentarinism in the flesh","Suffering from pseudopseudohypoparathyroidism","Arrete les flips tu connard!","A disciple of Pingu","A man of a thousand flips... well... 40","The god of bombparty","Insert Douglas Adams reference here because 42 flips","An Alpaca. Yes. An Alpaca. The flippest of animals besides giraffes","A giraffe. The flippest of the animals in the animal kingdom","You deserve a movie about you. The title 'Rainman' is taken though","If faggots were mountains, you'd be a volcano!"],alphabet:["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],alphapos:0,isThemed:!1,particleSpawnRate:"high",alias:[],notificationSound:new Audio("http://bombparty.sparklinlabs.com/sounds/myTurn.wav"),notifications:!0,endGameNotification:!1,speechName:"Google UK English Male"},gameImages={};var missingGameImgs=["avatarShadow","heart","heartEmpty","arrow","bomb","sparkle","avatarPlaceHolder","letter"],replacementImages={},replacementOffsets={},backupSources={},canvasContext=document.getElementById("GameCanvas").getContext("2d"),adventureTextFormat={format:function(e,t){return e.replace(/{(\d+)}/g,function(e,a){return"undefined"!=typeof t[a]?t[a]:e})},chooseText:function(e){var t=Array.prototype.slice.call(arguments,1),a=this.textBanks[e],n=a[Math.floor(Math.random()*a.length)];return this.format(n,t)},textBanks:{newRound:["Hark, the wheel turns yet again!","Lo and behold, a new round has cometh!","The crack of a new bomb, stand ready and begin the new day!","The whole bomb's a stage, and all the men and women merely nerds!","Give heed! The wordgrimage is set about, selectees!","With thine vocable, set forth and slay that which is fragmentary!","Words are swords, prompts be stomped!","Sticks and stones will break thy bones / And prompts will surely kill thee!"],userTurn:["It is thy turn, squire. You are facing off against {0}. Do thine worst!","A vile horror seeks thee. What is thine plan for {0}?","Nay, {0} fixes to tender thine flame. Take action!","A wild {0} appears!","Shalt thou stand and accomplish nothing against {0}?","{0} is about to wound thee. Time for a curt attack!","Heedeth thou the mighty {0}! Distress or scuffle is forthcoming!","Art thou harefooted or harebrained! Observe, it is {0}!"],playerTurn:["The heroic, {0}, faces the mighty {1}.","A ferocious roar as {1} corners {0}!","{0} needeth stand firm or be struck by {1}","{1} hath hunger who {0} might satisfy, lest!","{0} faces down the rat that is {1}!","{0} challenges the verminous {1}!","Behold the ravenous {1}! Will {0} succeed?","{0} versus {1}! The trepidation is palpable!"],userLevelUp:["LEVEL UP: Thou art now {0}","UPLEVEL : Now thou art {0}","RISE SIR, AS '{0}'","YOU FIT A NEW TITLE: {0}","THOU HAST EVOLVED INTO {0}","EXPERIENCE MOLDS YOU INTO {0}","YOU FEEL STRONGER: You become '{0}'","REJOICE, YOU ARE: {0}"],levelUp:["{0} levelled up to {1}","{0} has become {1}","{0} is now titled {1}","{0} has a new name: {1}","There is now a '{1}' among us","{0} is levelling up. What's your excuse, faggoth?","Out of his cocoon, {0} crawls like a majestic buttefly. How can I compare 'levelling up' to a summer's day?","{0} is evolving! Don't cream your pants, Pokémon faggots!"],userWinWord:["Thou hast slain the beast with your {0} and gained {1} EXP!","The hellion shatters for thine knowledge is vast. A well deserved {1} EXP!","Smite triumphed over bite! The prompt is no more. You gain {1} EXP!","Twas foolish of the beast to underestimate you. You gain {1} EXP","By Jove, the miscreant is rend like a brittle biscuit from your wallop. I say, good show!","No mercy have thou for these ogres. Let {0} be a lesson. You gain {1} EXP","Blasted vermin recoil in fear at thine mighty {0}. {1} EXP to thee!","Idle barking is met with a firm {0}."],winWord:["{0} has killed the beast with the mighty shout {1} and gained {2} EXP!","{0} fears no ghosts. His guiding {1} has fled them from the shadows!","{1}, an apt warcry from {0} who gained {2} EXP!","{0} decimates the hoodlum with {1} and gains {2} EXP","{1}, and then the dragon is no more! {0} feels stronger by {2} points!","{0} delivers the final blow to the whale with his {1}!","{1} was {0}'s weapon of choice and he earns {2} EXP","{0} shows no mercy and swings his {1}!"],userLostLife:["Thine ignorance woundeth and thou hast been hurt","Incompetent fool, you were lacerated by a mere rodent!","Thou areth assrapeth so fervently you lose heart!","If thy stuttereth again, thou shalt surely receive another blow such as this!","Nay, thou hast been set upon and crushed by that wild thing!","Is thy fighting as good as thy 'not-being-a-faggot' skill? Thine heart bleeds!","Thine tongue utters nothing and so thou art skewered like a pig! The agony!","Thou art badly contused by the assailing prompt. Man up or die, cutter!"],lostLife:["Alas... for poor {0} hath been hurt","{0} has been struck to the ground!","{0} cries can be heard echoing through these halls!","{0} receives hefty damage!","The horror kill and goes forth to claim its next victim","Sacre bleu. Les monstrosite c'est trop. {0} ne pas victoirement!","Don't look. {0} was badly mauled!","Oh lord gawd. {0} got roughed up!","{0} was generously harmed!"],userDeath:["and a grave loss for thou art dead. {0}, may thee rest in peace!","yet-th, thineth lifeth hateth endeth. Noth. Whyth?","but this is the end for you. Rest in pieces, sweet prince","however you face oblivion.","and thine life flasheth before thine eyes and thou realizes what a dead faggot thou art!","now you have left the realm of the living and enter the realm of spectators!","here, you expire like milk and smell like it too! Smelly dead {0}!","but bonk bonk you conk into the casket. The wonk was too stronk!"],death:["and weepeth, thee morn, for {0} hath left yonder mortal coil!","{0} exits the stage!","{0} is snuffed like a candle","{0} is no more, like, jeez, got dun dead good!","meow meow meow 'COMPLETELY DEAD' meow meow '{0}'","{0} kicks the bucket, knocks it over and swallows shit!","{0}, oh, in the prime of his 'not being able to answer prompts like the faggot he is', is deceased!","{0}, bites the dust, goes the way of all flesh, gives up the ghost, drops off. You know what I mean"],endRound:["All things must end and so it does with {0}!","The ordeal is over!","{0} was the death of all but one!","The seemingly unending wave of prompts comes to a halt!","Now, caged are the dogs of war!","And on that bombshell, {0}, we have to end!","Many have fallen! But not all!","Nothing lasts forever!, Yet..."],winner:["Rising from the ashes of felled brethren is the victorious {0}!","A knight in tested armor, still breathing, the glorious {0}!","Praise be the heroic {0} for that human/otherkin/refridgerator has not be vanquished!","The surviving faggot was indeed {0}","Ahoyhoy and a hullo for the indissoluble {0}","Is it a bird? Is it a plane? Whatever it is, it's {0}","Doctors hate {0}! The secret doctors don't want you to know is \"don't be a scrub\"!","{0} the unending, the ceaseless, the permanent, the unfading; the sole survivor!"]}},imgNodeConstructor=function(e,t){for(x in t)e[x]=t[x];return e};bpOverlayImgs={on:imgNodeConstructor(document.createElement("img"),{width:30,height:30,src:bpImgUrls.autoScrollOn}),off:imgNodeConstructor(document.createElement("img"),{width:30,height:30,src:bpImgUrls.autoScrollOff}),autoFocusOn:imgNodeConstructor(document.createElement("img"),{width:30,height:30,src:bpImgUrls.autoFocusOn}),autoFocusOff:imgNodeConstructor(document.createElement("img"),{width:30,height:30,src:bpImgUrls.autoFocusOff}),dragOff:imgNodeConstructor(document.createElement("img"),{width:30,height:30,src:bpImgUrls.dragOff}),dragOn:imgNodeConstructor(document.createElement("img"),{width:30,height:30,src:bpImgUrls.dragOn}),hideDeadOn:null,hideDeadOff:null},window.onresize=resize,document.body.addEventListener("dragover",drag_over,!1),document.body.addEventListener("drop",drop,!1);var dragAside=document.createElement("whatever");dragAside.id="dragonDrop",dragAside.draggable="true",dragAside.style.position="absolute",dragAside.style.left="100px",dragAside.style.top="100px",dragAside.style.width="300px",dragAside.style.background="rgb(20, 20, 20)",dragAside.addEventListener("dragstart",drag_start,!1),document.body.appendChild(dragAside);var toggleTextAdventure=function(e){if(e){bpOverlay.adventureFirstRun=!0,bpOverlay.adventureTextMode=!0;var t=document.getElementById("GameCanvas");t.parentNode.style.backgroundColor="rgb(20,20,20)",t.style.display="none";var a=document.createElement("DIV");a.id="adventure",a.className="adventureMeow",a.style.backgroundColor="rgb(20,20,20)";var n=document.createElement("P");n.id="adventurePINFO",n.className="adventureMeow";var o=0,r=["a","b","c","d","e","f","g","h","i","j","l","m","n","o","p","q","r","s","t","u","v"],s=200;for(i=0;i<channel.data.actors.length;i++)channel.data.actors[i].authId===window.app.user.authId&&(o=channel.data.actors[i].lives,r=channel.data.actors[i].lockedLetters,s=i);if(200==s)var l=0;else if(bpOverlay.flips[s]>=bpOverlay.adventureLevels.length)var l=bpOverlay.adventureLevels.length-1;else var l=bpOverlay.flips[s];n.innerHTML=window.app.user.displayName+" : "+bpOverlay.adventureLevels[l],n.style.color="rgb(255, 255, 51)";var c="";for(i in r)c+=r[i].toUpperCase();var d=document.createElement("DIV");d.id="adventureEXPINFO",d.className="adventureMeow",d.innerHTML="Experience needed: "+c,d.style.color="rgb(255,255,255)",a.appendChild(d),a.appendChild(n);var u=document.createElement("DIV");u.id="adventurePlayer",u.className="adventureMeow",u.style="position: relative",a.appendChild(u);var p=document.createElement("IMG");p.id="adventureAvatar",p.className="adventureMeow",p.src="undefined"==typeof window.app.user.pictureURL?"http://bombparty.sparklinlabs.com/images/AvatarPlaceholder.png":window.app.user.pictureURL,p.style="position: relative; float: right",u.appendChild(p);var m=document.createElement("DIV");m.id="adventureBars",m.className="adventureMeow",m.style="position: relative; float: right;",u.appendChild(m);var h=document.createElement("DIV");h.id="adventureHealth",h.className="adventureMeow",h.style="position: absolute;",h.style.width=10+70*o+"px",m.appendChild(h);var g=document.createElement("DIV");g.id="adventureExp",g.className="adventureMeow",g.style="position: absolute;",g.style.width=10+10*(21-r.length)+"px",m.appendChild(g);
var f=document.createElement("DIV");f.id="adventureTurns",f.className="adventureMeow",f.style="position: relative; float: right; color: #FFF",u.appendChild(f);var v=document.createElement("DIV");v.id="adventureMessages",v.className="adventureMeow",v.align="center",v.style="position: relative;",a.appendChild(v),t.parentNode.insertBefore(a,t),v.style.marginLeft="40px",v.style.marginTop="40px",v.style.clear="both",u.style.marginLeft="40px",u.style.marginTop="5px",u.style.overflow="hidden",n.style.marginLeft="40px",d.style.marginLeft="40px",d.style.marginTop="40px",p.style.height="76px",p.style.width="76px",p.style["float"]="left",m.style.marginLeft="10px",m.style.height="75px",m.style.width="400px",m.style.border="1px solid #141414",m.style["float"]="left",h.style.backgroundColor="rgb(255,255,0)",h.style.border="10px solid red",h.style.marginTop="8px",h.style.marginBottom="14px",g.style.backgroundColor="rgb(0,0,204)",g.style.border="10px solid blue",g.style.marginTop="14px",g.style.marginBottom="8px",f.style.marginLeft="20px",f.style["float"]="left"}else{bpOverlay.adventureTextMode=!1,bpOverlay.adventureFirstRun=!1;var y=document.getElementsByClassName("adventureMeow");for(i=0;i<y.length;i++)y[i].parentNode.removeChild(y[i]);var t=document.getElementById("GameCanvas");t.parentNode.style.backgroundColor="",t.style.display=""}},sendAdventureMessage=function(e,t){if(bpOverlay.adventureTextMode){var a=document.getElementById("adventureMessages"),n=document.createElement("P");n.style.color=t,n.innerHTML=e,a.children.length>10?(a.appendChild(n),a.removeChild(a.firstChild)):a.appendChild(n)}},particleEmitters=[],particleArray=[],particleImgs=[],rafID,textColors={"#cccccc":"statusText","#ffffff":"promptText","#a0a0a0":"wordText","#60aa60":"highlightedText","#404040":"bonusLetterText"},requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame,cancelAnimationFrame=window.cancelAnimationFrame||window.mozCancelAnimationFrame;loadCustomTheme=function(e){if(e&&!bpOverlay.isThemed){if(bpOverlay.isThemed=!0,e.images)for(var t in e.images){if(e.images[t].src||console.log("Error: source is not defined for image "+t+". Will try to execute anyway"),replacementImages[t]=e.images[t].src,e.images[t].xOffset||e.images[t].yOffset){var a={x:0,y:0};e.images[t].xOffset&&(a.x=e.images[t].xOffset),e.images[t].yOffset&&(a.y=e.images[t].yOffset),replacementOffsets[t]=a}replaceImage(t)}if(e.css)if(e.css.text){var n=document.createElement("style");n.id="customThemeStyle",n.appendChild(document.createTextNode(e.css.text)),document.getElementsByTagName("head")[0].appendChild(n)}else if(e.css.src){var n=document.createElement("style");n.id="customThemeStyle",n.src=e.css.src,document.getElementsByTagName("head")[0].appendChild(n)}else console.log("Error: css field declared but no valid css provided. Will try to execute anyway");if(e.particles){if(e.particles.images&&e.particles.images.length)for(t=0;t<e.particles.images.length;t++){var o=new Image;o.src=e.particles.images[t],particleImgs.push(o)}else console.log("Error: no particle images defined. Will try to execute anyway");var r=document.getElementById("GameCanvas"),i=r.getContext("2d"),s=(new Date).getTime();if(e.particles.emitters&&e.particles.emitters.length){var l=e.particles.emitters;for(t=0;t<l.length;t++){var c=l[t];c.spawnParticle=function(){if(Math.random()<c.spawnRate[bpOverlay.particleSpawnRate]){var e=Math.random(),t=c.position.x*r.width;c.position.width&&(t+=Math.random()*c.position.width*r.width);var a=c.position.y*r.height;c.position.height&&(a+=Math.random()*c.position.height*r.height);var n;n="number"==typeof c.velocity.x?c.velocity.x:c.velocity.x.min+(c.velocity.linkedToSize?e:Math.random())*(c.velocity.x.max-c.velocity.x.min);var o;o="number"==typeof c.velocity.y?c.velocity.y:c.velocity.y.min+(c.velocity.linkedToSize?e:Math.random())*(c.velocity.y.max-c.velocity.y.min);var i;i="number"==typeof c.size?c.size:c.size.min+e*(c.size.max-c.size.min);var s;s="number"==typeof c.rotation?c.rotation:c.rotation.min+(c.rotation.linkedToSize?e:Math.random())*(c.rotation.max-c.rotation.min);var l;if(l="number"==typeof c.angularVelocity?c.angularVelocity:c.angularVelocity.min+(c.angularVelocity.linkedToSize?e:Math.random())*(c.angularVelocity.max-c.angularVelocity.min),c.gravity)var d=c.gravity.x,u=c.gravity.y;else var d=0,u=0;particleArray.push({imageId:Math.floor(Math.random()*particleImgs.length),position:{x:t,y:a},velocity:{x:n,y:o},size:i,rotation:s,angularVelocity:l,gravity:{x:d,y:u},alpha:1})}}}}else e.particles.emitters!==[]&&e.particles.emitters||console.log("Error: Particles declared but no emitters defined. Will try to execute anyway");particleAnimate=function(){var a=e.particles.emitters;for(t=0;t<a.length;t++)a[t].spawnParticle();var n=(new Date).getTime(),o=Math.min((n-s)/1e3,1);for(s=n,i.setTransform(1,0,0,1,0,0),t=particleArray.length-1;t>=0;t--){var l=particleArray[t],c=particleImgs[l.imageId];if(l.position.x+=l.velocity.x*o,l.position.y+=l.velocity.y*o,l.rotation+=l.angularVelocity*o,l.rotation%=2*Math.PI,l.velocity.x+=l.gravity.x*o,l.velocity.y+=l.gravity.y*o,Math.abs(l.position.x-r.width/2)<100&&Math.abs(l.position.y-r.height/2)<200||l.position.x+u/2>r.width-Math.min(100,r.height/11*2)?l.alpha=Math.max(.1,l.alpha-.05):l.alpha<1&&(l.alpha=Math.min(1,l.alpha+.05)),l.alpha<1){var d=i.globalAlpha;i.globalAlpha=l.alpha}var u=c.width*l.size,p=c.height*l.size;i.translate(l.position.x,l.position.y),i.rotate(l.rotation),i.drawImage(c,-u/2,-p/2,u,p),i.rotate(-l.rotation),i.translate(-l.position.x,-l.position.y),l.alpha<1&&(i.globalAlpha=d),(l.x<-.2*r.width||l.position.y<-.2*r.height||l.position.x>1.2*r.width||l.position.y>1.2*r.height)&&particleArray.splice(t,1)}rafID=requestAnimationFrame(particleAnimate)},particleAnimate()}e.textStyles&&(i.fillTextRedux=i.fillText,i.fillText=function(){var t=i.shadowColor,a=i.shadowBlur,n=i.fillStyle,o=i.font,r=o.split("px "),s=r[0],l=r[1],c=e.textStyles[textColors[n]];if(c){c.color&&(i.fillStyle=c.color),c.shadow&&(i.shadowColor="#000",i.shadowBlur=10);var d=[s,l];"wordText"===textColors[n]||"highlightedText"===textColors[n]?"20"===s?c.majorFontSize&&(d[0]=c.majorFontSize):"14"===s&&c.minorFontSize&&(d[0]=c.minorFontSize):c.fontSize&&(d[0]=c.fontSize),c.fontFamily&&(d[1]=c.fontFamily),i.font=d.join("px ")}i.fillTextRedux.apply(this,arguments),i.font=o,i.fillStyle=n,i.shadowColor=t,i.shadowBlur=a},i.measureTextRedux=i.measureText,i.measureText=function(){var t=i.font,a=i.fillStyle,n=t.split("px "),o=n[0],r=n[1],s=e.textStyles[textColors[a]];if(s){var l=[o,r];("wordText"===textColors[a]||"highlightedText"===textColors[a])&&("20"===o?s.majorFontSize&&(l[0]=s.majorFontSize):"14"===o&&s.minorFontSize&&(l[0]=s.minorFontSize)),s.fontFamily&&(l[1]=s.fontFamily),i.font=l.join("px ")}var c=i.measureTextRedux.apply(this,arguments);return i.font=t,c});for(var t in gameImages)replaceImage(t)}else if(!e&&bpOverlay.isThemed){bpOverlay.isThemed=!1,(n=document.getElementById("customThemeStyle"))&&n.parentNode.removeChild(n),void 0!==rafID&&(cancelAnimationFrame(rafID),rafID=void 0);var i=document.getElementById("GameCanvas").getContext("2d");i.fillTextRedux&&(i.fillText=i.fillTextRedux),i.measureTextRedux&&(i.measureText=i.measureTextRedux);for(var t in gameImages)unreplaceImage(t);particleImgs=[],particleArray=[],replacementImages={},replacementOffsets={}}};var replaceImage=function(e){replacementImages[e]&&gameImages[e]&&(gameImages[e].src=replacementImages[e])},unreplaceImage=function(e){backupSources[e]&&gameImages[e]&&(gameImages[e].src=backupSources[e])},generateActorConditions=function(){if(bpOverlay.boxHasBeenCreated||bpOverlay.dragBoxHasBeenCreated){var e=document.getElementById("infoBox"),t=e.parentNode;t.removeChild(e),bpOverlay.boxHasBeenCreated=!1,bpOverlay.dragBoxHasBeenCreated=!1}for(bpOverlay.prevPlayerNames=bpOverlay.playerNames,bpOverlay.prevLostLives=bpOverlay.lostLives,bpOverlay.prevFlips=bpOverlay.flips,bpOverlay.prevUFlips=bpOverlay.uFlips,bpOverlay.prevTimeText=bpOverlay.timeText,bpOverlay.prevWordCount=bpOverlay.wordCount,bpOverlay.playerNames={},bpOverlay.playerAuthId={},bpOverlay.lostLives={},bpOverlay.flips={},bpOverlay.uFlips={},bpOverlay.alpha={},actors=channel.data.actors,i=0;i<actors.length;i++)bpOverlay.playerNames[i]=actors[i].displayName,bpOverlay.playerAuthId[actors[i].authId]=i,bpOverlay.flips[i]=0,bpOverlay.uFlips[i]=0,bpOverlay.lostLives[i]=0,bpOverlay.alpha[i]={progress:0,completed:0};bpOverlay.wordCount=0,bpOverlay.timeText=tran.t("timeText")+"0:00";var a=new Date;bpOverlay.startTime=a.getTime();var e=document.createElement("DIV");e.id="infoBox";var n=document.createElement("H2");n.id="infoBoxTimer",n.align="center",n.style.color="rgb(200,200,200)",n.textContent=bpOverlay.timeText,e.appendChild(n);var o=document.createElement("H2");o.align="center",o.id="infoWordCounter",o.style.color="rgb(200,200,200)",o.textContent=tran.t("wordCountText")+"0",e.appendChild(o);var r=document.createElement("hr");e.appendChild(r);var s=document.createElement("DIV");if(s.className="infoTableDiv",s.align="center",document.getElementById("containerSelect")){var l=document.getElementById("containerSelect");s.style.maxHeight="fitToPlayers"===l.value?"1000px":"100px"}s.style.overflowY="auto";var c=document.createElement("table");c.style.tableLayout="fixed",c.style.width="100%",s.appendChild(c);var d=document.createElement("tr"),u=document.createElement("td"),p=document.createElement("BUTTON"),m=document.createElement("DIV");m.className="headerButtonDiv",p.id="autoFocusButton",p.className="headerButton",p.title=tran.t("showHideButtonTitle"),p.onclick=function(){if(bpOverlay.hideDead=!bpOverlay.hideDead,bpOverlay.hideDead){p.removeChild(bpOverlayImgs.hideDeadOff),p.appendChild(bpOverlayImgs.hideDeadOn);var e=document.getElementsByClassName("playerRow");for(i=0;i<e.length;i++)"rgb(102, 102, 102)"==e[i].style.color&&(e[i].style.display="none")}else{p.removeChild(bpOverlayImgs.hideDeadOn),p.appendChild(bpOverlayImgs.hideDeadOff);var t=document.getElementById("ChatLog"),a=bpOverlay.autoScroll||t.scrollTop==t.scrollHeight,e=document.getElementsByClassName("playerRow");for(i=0;i<e.length;i++)"none"==e[i].style.display&&(e[i].style.display="table-row");var n=window.onresize;n(),a&&(t.scrollTop=t.scrollHeight)}},p.appendChild(bpOverlay.hideDead?bpOverlayImgs.hideDeadOn:bpOverlayImgs.hideDeadOff),m.appendChild(p),u.appendChild(m),d.appendChild(u);var h=document.createElement("td");h.textContent=tran.t("flipsText"),h.style.color="rgb(200,200,200)",h.align="center",h.style.padding="2px",h.style.fontSize="11px",h.style.width="40px",h.title=tran.t("flipsTitle"),d.appendChild(h);var g=document.createElement("td");g.textContent=tran.t("uFlipsText"),g.style.color="rgb(200,200,200)",g.align="center",g.style.padding="2px",g.style.fontSize="11px",g.style.width="40px",g.title=tran.t("uFlipsTitle"),d.appendChild(g);var f=document.createElement("td");f.textContent=tran.t("deathsText"),f.style.color="rgb(200,200,200)",f.align="center",f.style.padding="2px",f.style.fontSize="11px",f.style.width="40px",f.title=tran.t("deathsTitle"),d.appendChild(f),c.appendChild(d);var v=document.createElement("td");for(v.textContent=tran.t("alphaText"),v.className="alphaColumn",v.style.color="rgb(200,200,200)",v.align="center",v.style.padding="2px",v.style.fontSize="11px",v.style.width="40px",v.title=tran.t("alphaTitle"),d.appendChild(v),i=0;i<actors.length;i++){var y=document.createElement("tr");y.id=i+" row",y.className="playerRow",actors[i].authId===app.user.authId&&(y.style.background="rgba(255,0,0,0.1)"),"dead"==actors[i].state?(y.style.color="#666",bpOverlay.hideDead&&(y.style.display="none")):y.style.color="rgb(210,210,210)";var b=document.createElement("td"),x=bpOverlay.playerNames[i];b.textContent=x,b.align="center",b.style.whiteSpace="nowrap",b.style.overflow="hidden",b.style.textOverflow="ellipsis",y.appendChild(b);var w=document.createElement("td");w.id=i+" flips",w.textContent="0",w.align="center",y.appendChild(w);var T=document.createElement("td");T.id=i+" uFlips",T.textContent="0",T.align="center",y.appendChild(T);var O=document.createElement("td");O.id=i+" lives",O.textContent="0",O.align="center",y.appendChild(O);var E=document.createElement("td");E.className="alphaColumn",E.id=i+" alpha",E.innerHTML="A (0)",E.align="center",y.appendChild(E),c.appendChild(y)}if(e.appendChild(s),bpOverlay.dragonDrop){var I=document.getElementById("dragonDrop");I.appendChild(e),bpOverlay.dragBoxHasBeenCreated=!0}else{var C=document.getElementById("Sidebar");C.insertBefore(e,C.firstChild),bpOverlay.boxHasBeenCreated=!0}var B=window.onresize;if(B(),bpOverlay.autoScroll){var A=document.getElementById("ChatLog");A.scrollTop=A.scrollHeight}},generateSettingsElement=function(e,t,a,n){var o=document.getElementById("overlaySettingsTable"),r=document.createElement("TR");o.appendChild(r);var i=document.createElement("TD");i.innerHTML=e,r.appendChild(i);var s=document.createElement("TD");r.appendChild(s);var l=document.createElement("SELECT");l.id=a,s.appendChild(l);for(x in t){var c=document.createElement("OPTION");c.textContent=t[x],c.value=x,l.appendChild(c)}l.onchange=n},makeHeaderButton=function(e,t,a,n,o,r){var i=document.createElement("BUTTON"),s=document.createElement("DIV");s.className="headerButtonDiv";var l=document.getElementsByTagName("header")[0],c=l.lastChild;l.insertBefore(s,c);var d=document.createElement("img");d=e;var u=document.createElement("img");u=t,i.id=a,i.className="headerButton",i.title=n,i.onclick=r,o?(i.appendChild(e),i.dataset.state=!0):(i.appendChild(t),i.dataset.state=!1),s.appendChild(i)},updateTime=function(){if("playing"===channel.data.state&&(bpOverlay.boxHasBeenCreated||bpOverlay.dragBoxHasBeenCreated)){var e=new Date,t=Math.floor((e.getTime()-bpOverlay.startTime)/1e3);if(10>t%60)var a="0";else var a="";bpOverlay.timeText=tran.t("timeText")+Math.floor(t/60)+":"+a+t%60,document.getElementById("infoBoxTimer").textContent=bpOverlay.timeText}},twitchify=function(e){if(bpOverlay.twitchOn){if(window.hasOwnProperty("twitch_global"))for(i in twitch_global)e=e.replace(new RegExp("\\b"+i+"\\b","g"),'<img src="http:'+twitch_global[i].url+'" title="'+i+'" style="margin-bottom:-6px"></img>');if(window.hasOwnProperty("twitch_subscriber")){for(var t,a=[],n=/\b\w+:\w+\b/g;t=n.exec(e);)a.push(t[0]);for(toReplace={},i=0;i<a.length;i++){var o=a[i].split(":"),r=o[0].toLowerCase(),s=o[1];toReplace[a[i]]||twitch_subscriber[r]&&twitch_subscriber[r].emotes[s]&&(toReplace[r+":"+s]=twitch_subscriber[r].emotes[s])}for(i in toReplace)e=e.replace(new RegExp(i,"g"),'<img src="http:'+toReplace[i]+'" title="'+i+'" style="margin-bottom:-6px"></img>')}}return bpOverlay.markupOn&&(e=e.replace(/&lt;(\/?[BISUbisu])&gt;/g,"<$1>")),e},wrapGameFunctions=function(){var e=canvasContext;e.drawImageRedux=e.drawImage,e.drawImage=function(){for(a=0;a<missingGameImgs.length;a++)if(-1!=arguments[0].src.toLowerCase().indexOf("/images/"+missingGameImgs[a].toLowerCase()+".png")){gameImages[missingGameImgs[a]]=arguments[0],backupSources[missingGameImgs[a]]=arguments[0].src,bpOverlay.isThemed&&replaceImage(missingGameImgs[a]),missingGameImgs.splice(a,1);break}var t=!1;for(var a in replacementOffsets)if(gameImages[a]&&gameImages[a].src===arguments[0].src){t=replacementOffsets[a],e.translate(t.x,t.y);break}var n=e.drawImageRedux.apply(this,arguments);return t&&e.translate(-t.x,-t.y),n},channel.socket.listeners("chatMessage").pop(),channel.socket.on("chatMessage",function(e){var t,a=!1;if(e.text){var n=e.text.toLowerCase();if(bpOverlay.notifications)if(-1!==(t=n.indexOf(app.user.displayName.toLowerCase())))0!==t&&-1===n[t-1].search(/\W/)||!(t+app.user.displayName.length>=n.length||-1!==n[t+app.user.displayName.length].search(/\W/))||(document.hidden&&bpOverlay.notificationSound.play(),a=!0);else for(var o=0;o<bpOverlay.alias.length;o++)if(-1!==(t=n.indexOf(bpOverlay.alias[o]))&&(0===t||-1!==n[t-1].search(/\W/))&&(t+bpOverlay.alias[o].length>=n.length||-1!==n[t+bpOverlay.alias[o].length].search(/\W/))){document.hidden&&bpOverlay.notificationSound.play(),a=!0;break}}null!=e.userAuthId?channel.appendToChat("Message Author-"+e.userAuthId.replace(/:/g,"_")+(a?" highlighted":""),JST["nuclearnode/chatMessage"]({text:e.text,author:JST["nuclearnode/chatUser"]({user:channel.data.usersByAuthId[e.userAuthId],i18n:i18n,app:app})})):channel.appendToChat("Info"+(a?" highlighted":""),i18n.t("nuclearnode:chat."+e.text))}),JST["nuclearnode/chatMessage"]=function(e){var t,a=[],n=e||{};return function(e,n){a.push((null==(t=e)?"":t)+':  <span class="Content">'+twitchify(jade.escape(null==(t=n)?"":t))+"</span>")}.call(this,"author"in n?n.author:"undefined"!=typeof author?author:void 0,"text"in n?n.text:"undefined"!=typeof text?text:void 0),a.join("")},JST["nuclearnode/chatUser"]=function(e){var t,a=[],n=e||{};return function(e,n){var o=[];(function(){var t=e.serviceHandles;if("number"==typeof t.length)for(var a=0,r=t.length;r>a;a++){var i=t[a];null==i&&(i=n.t("nuclearnode:serviceHandlePlaceholder")),"guest"!=a&&o.push(n.t("nuclearnode:userHandleOnService",{handle:i,service:n.t("nuclearnode:loginServices."+a)}))}else{var r=0;for(var a in t){r++;var i=t[a];null==i&&(i=n.t("nuclearnode:serviceHandlePlaceholder")),"guest"!=a&&o.push(n.t("nuclearnode:userHandleOnService",{handle:i,service:n.t("nuclearnode:loginServices."+a)}))}}}).call(this),a.push("<span"+jade.attr("title",o.join(", "),!0,!1)+' class="User">'),""!=e.role&&a.push("<span"+jade.attr("title",n.t("nuclearnode:userRoles."+e.role),!0,!1)+jade.cls(["UserRole_"+e.role],[!0])+"></span> "),a.push(jade.escape(null==(t=e.displayName)?"":t)),a.push("</span>")}.call(this,"user"in n?n.user:"undefined"!=typeof user?user:void 0,"i18n"in n?n.i18n:"undefined"!=typeof i18n?i18n:void 0,"app"in n?n.app:"undefined"!=typeof app?app:void 0),a.join("")};var t=channel.appendToChat;channel.appendToChat=function(e,a){try{if(a=Autolinker.link(a,{className:"chatMessageLink"}),"Info"===e&&-1===a.indexOf('class="User"')&&(a=twitchify(a)),bpOverlay.autoScroll){var n=document.getElementById("ChatLog");n.scrollTop=n.scrollHeight}}finally{t(e,a)}};var a=channel.socket.listeners("setActivePlayerIndex").shift();channel.socket.on("setActivePlayerIndex",function(e){try{if(bpOverlay.firstRun&&(generateActorConditions(),bpOverlay.alphapos=0,bpOverlay.firstRun=!1,bpOverlay.adventureTextMode&&(document.getElementById("adventureMessages").innerHTML="",sendAdventureMessage(adventureTextFormat.chooseText("newRound"),"rgb(10,200,150)")),bpOverlay.adventureFirstRun=!0),sendAdventureMessage("break","rgb(20,20,20"),bpOverlay.autoFocus||bpOverlay.adventureTextMode){if(bpOverlay.adventureTextMode){var t=0,n=["a","b","c","d","e","f","g","h","i","j","l","m","n","o","p","q","r","s","t","u","v"],o=200;for(i=0;i<channel.data.actors.length;i++)channel.data.actors[i].authId===window.app.user.authId&&(t=channel.data.actors[i].lives,n=channel.data.actors[i].lockedLetters,o=i);if(200==o)var r=0;else if(bpOverlay.flips[o]>=bpOverlay.adventureLevels.length)var r=bpOverlay.adventureLevels.length-1;else var r=bpOverlay.flips[o];var s=document.getElementById("adventurePINFO");s.innerHTML=window.app.user.displayName+" : "+bpOverlay.adventureLevels[r];var l=document.getElementById("adventureEXPINFO"),c="";for(i in n)c+=n[i].toUpperCase();l.innerHTML="Experience needed: "+c;var d=document.getElementById("adventureHealth");d.style.width=10+70*t+"px";var u=document.getElementById("adventureExp");u.style.width=10+10*(21-n.length)+"px"}bpOverlay.focusNext&&bpOverlay.autoFocus&&(setTimeout(function(){document.getElementById("ChatInputBox").focus()},400),bpOverlay.focusNext=!1),bpOverlay.adventureFirstRun||(channel.data.actors[e].authId===window.app.user.authId?(bpOverlay.autoFocus&&(bpOverlay.focusNext=!0),sendAdventureMessage(adventureTextFormat.chooseText("userTurn",channel.data.wordRoot),"rgb(90, 250, 0)")):sendAdventureMessage(adventureTextFormat.chooseText("playerTurn",channel.data.actors[e].displayName,channel.data.wordRoot),"rgb(255, 165, 0)"))}}finally{a(e),bpOverlay.adventureFirstRun&&(bpOverlay.adventureFirstRun=!1,setTimeout(function(){channel.data.actors[e].authId===window.app.user.authId?(bpOverlay.autoFocus&&(bpOverlay.focusNext=!0),sendAdventureMessage(adventureTextFormat.chooseText("userTurn",channel.data.wordRoot),"rgb(90, 250, 0)")):sendAdventureMessage(adventureTextFormat.chooseText("playerTurn",channel.data.actors[e].displayName,channel.data.wordRoot),"rgb(255, 165, 0)")},100)),bpOverlay.adventureTextMode&&setTimeout(function(){for(i=0;i<channel.data.actors.length;i++){var e=document.getElementById("adventureTurns"),t=channel.data.activePlayerIndex;if(t==i){if("undefined"==typeof channel.data.actors[t].pictureURL)var a="http://bombparty.sparklinlabs.com/images/AvatarPlaceholder.png";else var a=channel.data.actors[t].pictureURL;var n=21-channel.data.actors[t].lockedLetters.length,o="";for(j=0;j<channel.data.actors[t].lives;j++)o+="♥";e.innerHTML="<img src=' "+a+"' height='70px' width='70px' style='float:left; margin-right: 10px'></img><div style='float:right;'><p style='color: #DFA'>"+channel.data.actors[i].displayName+"<p style='color: orange'>Lives: <span style='color: red'>"+o+"</span></p><p style='color: #A746C7'>EXP: <span style='color: #7D8ADB'>"+n+"/21</div>"}}},100)}});var n=channel.socket.listeners("winWord").shift();channel.socket.on("winWord",function(e){try{var t=channel.data.actorsByAuthId[e.playerAuthId],a=bpOverlay.playerAuthId[e.playerAuthId],o=t.lockedLetters.slice(),r=t.lastWord.toLowerCase(),s=o.length;for(i=0;i<r.length;i++){var l;-1!=(l=o.indexOf(r[i]))&&o.splice(l,1)}var c=s-o.length;r[0].toLowerCase()===bpOverlay.alphabet[bpOverlay.alpha[a].progress]&&(bpOverlay.alpha[a].progress++,bpOverlay.alpha[a].progress>=bpOverlay.alphabet.length&&(bpOverlay.alpha[a].progress=0,bpOverlay.alpha[a].completed++),(bpOverlay.boxHasBeenCreated||bpOverlay.dragBoxHasBeenCreated)&&(document.getElementById(a+" alpha").textContent=bpOverlay.alphabet[bpOverlay.alpha[a].progress].toUpperCase()+" ("+bpOverlay.alpha[a].completed+")"));var d=0===o.length;if(d){if(bpOverlay.flips[a]+=1,(bpOverlay.boxHasBeenCreated||bpOverlay.dragBoxHasBeenCreated)&&(document.getElementById(a+" flips").textContent=bpOverlay.flips[a]),3===t.lives&&(bpOverlay.uFlips[a]+=1,(bpOverlay.boxHasBeenCreated||bpOverlay.dragBoxHasBeenCreated)&&(document.getElementById(a+" uFlips").textContent=bpOverlay.uFlips[a])),bpOverlay.flips[a]>=bpOverlay.adventureLevels.length)var u=bpOverlay.adventureLevels.length-1;else var u=bpOverlay.flips[a];channel.data.actors[a].displayName===window.app.user.displayName?sendAdventureMessage(adventureTextFormat.chooseText("userLevelUp",bpOverlay.adventureLevels[u]),"rgb(200, 200, 0"):sendAdventureMessage(adventureTextFormat.chooseText("levelUp",channel.data.actors[a].displayName,bpOverlay.adventureLevels[u]),"rgb(200, 200, 0)")}else channel.data.actors[a].displayName===window.app.user.displayName?sendAdventureMessage(adventureTextFormat.chooseText("userWinWord",t.lastWord.toUpperCase(),c),"rgb(250, 0, 250)"):sendAdventureMessage(adventureTextFormat.chooseText("winWord",t.displayName,t.lastWord.toUpperCase(),c),"rgb(250, 0, 250)");bpOverlay.wordCount+=1,(bpOverlay.boxHasBeenCreated||bpOverlay.dragBoxHasBeenCreated)&&(document.getElementById("infoWordCounter").textContent=tran.t("wordCountText")+bpOverlay.wordCount),channel.data.actors[a].displayName===window.app.user.displayName&&(bpOverlay.alphabet.length<=bpOverlay.alphapos?bpOverlay.alphapos=0:bpOverlay.alphapos++)}finally{n(e)}});var o=channel.socket.listeners("setPlayerLives").shift();channel.socket.on("setPlayerLives",function(e){try{e.playerAuthId===window.app.user.authId?sendAdventureMessage(adventureTextFormat.chooseText("userLostLife"),"rgb(255,20,10)"):sendAdventureMessage(adventureTextFormat.chooseText("lostLife",channel.data.actorsByAuthId[e.playerAuthId].displayName),"rgb(255,20,10)");var t=channel.data.actorsByAuthId[e.playerAuthId],a=bpOverlay.playerAuthId[e.playerAuthId];t.lives>e.lives&&(bpOverlay.lostLives[a]+=1,(bpOverlay.boxHasBeenCreated||bpOverlay.dragBoxHasBeenCreated)&&(document.getElementById(a+" lives").textContent=bpOverlay.lostLives[a]))}finally{o(e)}});var r=channel.socket.listeners("setPlayerState").shift();channel.socket.on("setPlayerState",function(e){try{if((bpOverlay.boxHasBeenCreated||bpOverlay.dragBoxHasBeenCreated)&&"dead"==e.state){var t=bpOverlay.playerAuthId[e.playerAuthId],a=document.getElementById(t+" row");a.style.color="#666",bpOverlay.hideDead&&(a.style.display="none"),e.playerAuthId===window.app.user.authId?sendAdventureMessage(adventureTextFormat.chooseText("userDeath",channel.data.actorsByAuthId[e.playerAuthId].displayName),"rgb(255,255,255"):sendAdventureMessage(adventureTextFormat.chooseText("death",channel.data.actorsByAuthId[e.playerAuthId].displayName),"rgb(255,255,255")}}finally{r(e)}});var s=channel.socket.listeners("endGame").shift();channel.socket.on("endGame",function(e){try{bpOverlay.firstRun=!0,bpOverlay.adventureTextMode&&(document.getElementById("adventureMessages").innerHTML="",document.getElementById("adventureTurns").innerHTML="",sendAdventureMessage(adventureTextFormat.chooseText("endRound",channel.data.wordRoot.toUpperCase()),"rgb(204, 255, 204)")),bpOverlay.autoFocus&&bpOverlay.focusNext&&(setTimeout(function(){document.getElementById("ChatInputBox").focus()},400),bpOverlay.focusNext=!1),bpOverlay.endGameNotification&&document.hidden&&bpOverlay.notificationSound.play(),updateTime()}finally{s(e),setTimeout(function(){sendAdventureMessage(adventureTextFormat.chooseText("winner",channel.data.lastWinner),"rgb(24, 24, 255)")},100)}});var l=function(){var e=document.getElementsByClassName("ChannelUsers")[0],t=tran.t("playersTitle");for(var a in channel.data.users)t+="\n"+channel.data.users[a].displayName;if(e.title=t,document.getElementById("PlayerList"))var n=document.getElementById("PlayerList");else{var o=document.getElementById("overlaySettingsTab"),n=document.createElement("DIV");n.id="PlayerList",o.appendChild(n)}var r="";for(var a in channel.data.users){var i=channel.data.users[a],s=i.serviceHandles,l=[],c=i18n,d=app,u=[];(function(){var e=i.serviceHandles;if("number"==typeof e.length)for(var t=0,a=e.length;a>t;t++){var n=e[t];null==n&&(n=c.t("nuclearnode:serviceHandlePlaceholder")),"guest"!=t&&u.push(c.t("nuclearnode:userHandleOnService",{handle:n,service:c.t("nuclearnode:loginServices."+t)}))}else{var a=0;for(var t in e){a++;var n=e[t];null==n&&(n=c.t("nuclearnode:serviceHandlePlaceholder")),"guest"!=t&&u.push(c.t("nuclearnode:userHandleOnService",{handle:n,service:c.t("nuclearnode:loginServices."+t)}))}}}).call(this),l.push("<span"+jade.attr("title",u.join(", "),!0,!1)+' class="User">'),""!=i.role&&l.push("<span"+jade.attr("title",c.t("nuclearnode:userRoles."+i.role),!0,!1)+jade.cls(["UserRole_"+i.role],[!0])+"></span> "),l.push(jade.escape(null==(s=i.displayName)?"":s)),-1!=["host","hubAdministrator","moderator"].indexOf(d.user.role)&&(l.push('<span class="Actions"><button'+jade.attr("data-auth-id",i.authId,!0,!1)+jade.attr("data-display-name",i.displayName,!0,!1)+' class="BanUser">'+jade.escape(null==(s=c.t("nuclearnode:chat.ban"))?"":s)+"</button>"),("host"==d.user.role||"hubAdministrator"==d.user.role)&&l.push("<button"+jade.attr("data-auth-id",i.authId,!0,!1)+jade.attr("data-display-name",i.displayName,!0,!1)+' class="ModUser">'+jade.escape(null==(s=c.t("nuclearnode:chat.mod"))?"":s)+"</button>"),l.push("</span>")),l.push("</span>"),r+=l.join(""),r+="<br />"}n.innerHTML=r};channel.socket.on("addUser",l),channel.socket.on("removeUser",l),channel.socket.on("setUserRole",l),l()},firstRunProcs=function(){function e(){for(i=0;i<=2;i++)document.getElementById("SidebarTabButtons").children[i].setAttribute("class","");for(i=0;i<=2;i++)document.getElementById("SidebarTabs").children[i].setAttribute("class","");document.getElementById("overlaySettingsButton").setAttribute("class","Active"),document.getElementById("overlaySettingsTab").setAttribute("class","Active")}var t=document.createElement("style");t.appendChild(document.createTextNode('.headerButtonDiv {  display: -webkit-box;  display: -moz-box;  display: -webkit-flex;  display: -ms-flexbox;  display: box;  display: flex;  opacity: 0.3;  -ms-filter: "progid:DXImageTransform.Microsoft.Alpha(Opacity=30)";  filter: alpha(opacity=30);} .headerButtonDiv:hover {  opacity: 1;  -ms-filter: none;  filter: none;} button.headerButton {  border: none;  background: none;  cursor: pointer;  opacity: 0.5;  -ms-filter: "progid:DXImageTransform.Microsoft.Alpha(Opacity=50)";  filter: alpha(opacity=50);  display: -webkit-box;  display: -moz-box;  display: -webkit-flex;  display: -ms-flexbox;  display: box;  display: flex;} button.headerButton:hover {  opacity: 0.8;  -ms-filter: "progid:DXImageTransform.Microsoft.Alpha(Opacity=80)";  filter: alpha(opacity=80);} button.headerButton:active {  opacity: 1;  -ms-filter: none;  filter: none;} .infoTableDiv::-webkit-scrollbar { width: 15px; height: 15px; } .infoTableDiv::-webkit-scrollbar-button { height: 0px; width: 0px; } .infoTableDiv::-webkit-scrollbar-track { background-color: rgba(0,0,0,0.05); } .infoTableDiv::-webkit-scrollbar-thumb { background-color: rgba(255,255,255,0.1); border: 3px solid transparent; -webkit-border-radius: 6px; border-radius: 6px; -webkit-background-clip: content; -moz-background-clip: content; background-clip: content-box; } .infoTableDiv::-webkit-scrollbar-thumb:hover { background-color: rgba(255,255,255,0.15); } .infoTableDiv::-webkit-scrollbar-corner { background-color: rgba(255,255,255,0.1); }#overlaySettingsTab{text-align:left;overflow-y:auto}#overlaySettingsTab h2{padding:.5em .5em 0;opacity:.5;-ms-filter:"alpha(Opacity=50)";filter:alpha(opacity=50)}#overlaySettingsTab table{width:100%;padding:.5em}#overlaySettingsTab table tr td:nth-child(1){width:40%}#overlaySettingsTab table tr td:nth-child(2){width:60%}#overlaySettingsTab table button:not(.UnbanUser),#overlaySettingsTab table input,#overlaySettingsTab table select,#overlaySettingsTab table textarea{width:100%;background:#444;border:none;padding:.25em;color:#fff;font:inherit}#overlaySettingsTab table textarea{resize:vertical;min-height:3em}#overlaySettingsTab table ul{list-style:none}#overlaySettingsTab .User .UserRole_hubAdministrator:before{content:\'[★]\';cursor:default;color:#c63}#overlaySettingsTab .User .UserRole_host:before{content:\'★\';cursor:default;color:#dc8}#overlaySettingsTab .User .UserRole_administrator:before{content:\'☆\';cursor:default;color:#dc8}#overlaySettingsTab .User .UserRole_moderator:before{content:\'●\';cursor:default;color:#346192}#overlaySettingsTab .Actions button{border:none;background:0 0;cursor:pointer;margin:0 .25em;outline:0;font-weight:400;font-size:smaller;opacity:.8;-ms-filter:"alpha(Opacity=80)";filter:alpha(opacity=80)}#overlaySettingsTab .Actions button.BanUser{color:#a00}#overlaySettingsTab .Actions button.ModUser,#overlaySettingsTab .Actions button.UnmodUser{color:#2a3}#overlaySettingsTab .Actions button:hover{opacity:1;-ms-filter:none;filter:none}#overlaySettingsTab .Actions button:active{background:rgba(255,0,0,.2)}#overlaySettingsTab input{-moz-user-select:text;-webkit-user-select:text;-ms-user-select:text}#ChatLog .highlighted{background: rgba(255, 0, 0, 0.05);}#ChatLog .highlighted:hover {background: rgba(255, 0, 0, 0.1);}')),document.getElementsByTagName("head")[0].appendChild(t);var a=document.createElement("img");a.width=15,a.height=15,a.src=bpImgUrls.hideDeadOn,bpOverlayImgs.hideDeadOn=a;var n=document.createElement("img");n.width=15,n.height=15,n.src=bpImgUrls.hideDeadOff,bpOverlayImgs.hideDeadOff=n,makeHeaderButton(bpOverlayImgs.on,bpOverlayImgs.off,"chatDownButton",tran.t("chatDownButtonTitle"),!0,function(){bpOverlay.autoScroll=!bpOverlay.autoScroll,bpOverlay.autoScroll?(document.getElementById("chatDownButton").removeChild(bpOverlayImgs.off),document.getElementById("chatDownButton").appendChild(bpOverlayImgs.on),document.getElementById("chatDownButton").dataset.state=!0):(document.getElementById("chatDownButton").removeChild(bpOverlayImgs.on),document.getElementById("chatDownButton").appendChild(bpOverlayImgs.off),document.getElementById("chatDownButton").dataset.state=!1)
}),makeHeaderButton(bpOverlayImgs.autoFocusOn,bpOverlayImgs.autoFocusOff,"autoFocusButton",tran.t("autoFocusButtonTitle"),!0,function(){bpOverlay.autoFocus=!bpOverlay.autoFocus,bpOverlay.autoFocus?(document.getElementById("autoFocusButton").removeChild(bpOverlayImgs.autoFocusOff),document.getElementById("autoFocusButton").appendChild(bpOverlayImgs.autoFocusOn),document.getElementById("autoFocusButton").dataset.state=!0):(document.getElementById("autoFocusButton").removeChild(bpOverlayImgs.autoFocusOn),document.getElementById("autoFocusButton").appendChild(bpOverlayImgs.autoFocusOff),document.getElementById("autoFocusButton").dataset.state=!1)}),makeHeaderButton(bpOverlayImgs.dragOn,bpOverlayImgs.dragOff,"dragButton",tran.t("dragButtonTitle"),!1,function(){if(bpOverlay.boxHasBeenCreated||bpOverlay.dragBoxHasBeenCreated){bpOverlay.dragonDrop=!bpOverlay.dragonDrop;var e=document.getElementById("dragButton"),t=document.getElementById("Sidebar"),a=document.getElementById("infoBox"),n=document.getElementById("dragonDrop");bpOverlay.dragonDrop?(t.removeChild(a),n.appendChild(a),e.removeChild(bpOverlayImgs.dragOff),e.appendChild(bpOverlayImgs.dragOn),bpOverlay.dragBoxHasBeenCreated=!0,bpOverlay.boxHasBeenCreated=!1,e.dataset.state=!0):(n.removeChild(a),t.insertBefore(a,t.firstChild),bpOverlay.dragBoxHasBeenCreated=!1,bpOverlay.boxHasBeenCreated=!0,e.removeChild(bpOverlayImgs.dragOn),e.appendChild(bpOverlayImgs.dragOff),e.dataset.state=!1)}else{bpOverlay.dragonDrop=!bpOverlay.dragonDrop;var e=document.getElementById("dragButton");bpOverlay.dragonDrop?(e.removeChild(bpOverlayImgs.dragOff),e.appendChild(bpOverlayImgs.dragOn),e.dataset.state=!0):(e.removeChild(bpOverlayImgs.dragOn),e.appendChild(bpOverlayImgs.dragOff),e.dataset.state=!1)}});var o=document.getElementById("SidebarTabButtons"),r=document.getElementById("SidebarTabs"),s=r.children[1].cloneNode(!0);s.id="overlaySettingsTab",s.setAttribute("class",""),s.innerHTML="";var l=o.children[0].cloneNode(!0);l.id="overlaySettingsButton",l.setAttribute("class",""),l.innerHTML="BpOS",l.title=tran.t("overlaySettingsButtonTitle"),o.appendChild(l),r.appendChild(s),l.onclick=e;var c=document.createElement("H2");c.id="bpOverlayH2",c.onclick=function(){jQ("#overlaySettingsTableWrapper").slideToggle("slow")},c.onmouseover=function(){jQ("#bpOverlayH2").css("text-shadow","0 0 24px white")},c.onmouseout=function(){jQ("#bpOverlayH2").css("text-shadow","0 0 0px black")},c.textContent=tran.t("overlaySettingsText");var d=document.getElementById("overlaySettingsTab");d.appendChild(c);var u=document.createElement("DIV");u.style.display="none",u.id="overlaySettingsTableWrapper";var p=document.createElement("TABLE");p.id="overlaySettingsTable",u.appendChild(p),d.appendChild(u);var m=document.createElement("H2");m.id="PlayerListH2",m.textContent=tran.t("playerListText"),m.onclick=function(){jQ("#PlayerList").slideToggle("slow")},m.onmouseover=function(){jQ("#PlayerListH2").css("text-shadow","0 0 24px white")},m.onmouseout=function(){jQ("#PlayerListH2").css("text-shadow","0 0 0px black")},d.appendChild(m);var h=document.createElement("DIV");h.id="PlayerList",h.style.display="none",h.style.marginLeft="8px",d.appendChild(h);var g=document.createElement("H2");g.id="creditsH2",g.onclick=function(){jQ("#creditsTableWrapper").slideToggle("slow"),jQ("#creditsTextDiv").slideToggle("slow")},g.onmouseover=function(){jQ("#creditsH2").css("text-shadow","0 0 24px white")},g.onmouseout=function(){jQ("#creditsH2").css("text-shadow","0 0 0px black")},g.textContent=tran.t("creditsText"),d.appendChild(g);var f=document.createElement("TABLE"),v=document.createElement("DIV");v.style.display="none",v.id="creditsTableWrapper",f.id="creditsTable",f.innerHTML="				<tr><td>"+tran.t("credits1")+"</td><td>MrInanimated</td></tr>				<tr><td>"+tran.t("credits2")+"</td><td>Skandalabrandur</td></tr>				<tr><td>"+tran.t("credits3")+"</td><td>Sanc</td></tr>				<tr><td>"+tran.t("creditsAutolinker")+'</td><td><a href="https://github.com/gregjacobs/Autolinker.js">Autolinker.js</a></td></tr>				<tr><td>'+tran.t("creditsTwitchEmotes")+'</td><td><a href="http://twitchemotes.com/">twitchemotes.com</a></td></tr>',v.appendChild(f),d.appendChild(v);var y=document.createElement("DIV");y.textContent=tran.t("creditsTextText"),y.style.marginLeft="8px",y.id="creditsTextDiv",y.style.display="none",d.appendChild(y),generateSettingsElement(tran.t("containerSizeName"),{compact:tran.t("containerSizeOptions.compact"),fitToPlayers:tran.t("containerSizeOptions.fitToPlayers")},"containerSelect",function(){var e=document.getElementsByClassName("infoTableDiv")[0],t=document.getElementById("containerSelect");if(e&&t)if("compact"===t.value)e.style.maxHeight="100px";else if("fitToPlayers"===t.value){e.style.maxHeight="1000px";var a=window.onresize;a()}}),generateSettingsElement(tran.t("twitchEmotesName"),{on:tran.t("twitchEmotesOptions.on"),off:tran.t("twitchEmotesOptions.off")},"twitchEmoteSelect",function(){var e=document.getElementById("twitchEmoteSelect");"on"===e.value?bpOverlay.twitchOn=!0:"off"===e.value&&(bpOverlay.twitchOff=!1)}),generateSettingsElement(tran.t("textAdventureName"),{off:tran.t("textAdventureOptions.off"),on:tran.t("textAdventureOptions.on")},"adventureSetting",function(){var e=document.getElementById("adventureSetting");toggleTextAdventure("on"===e.value?!0:"off"===e.value?!1:!1)}),generateSettingsElement(tran.t("hardModesName"),{none:tran.t("hardModesOptions.none"),rev:tran.t("hardModesOptions.rev"),jqv:tran.t("hardModesOptions.jqv"),az:tran.t("hardModesOptions.az"),xz:tran.t("hardModesOptions.xz")},"hardModes",function(){var e=document.getElementById("hardModes");if("rev"===e.value){var t=document.getElementById("WordInputBox"),a=function(){document.getElementById("WordInputBox").value=document.getElementById("WordInputBox").value.split("").reverse().join("")};t.onchange=a}else if("jqv"===e.value){var t=document.getElementById("WordInputBox"),a=function(){var e=document.getElementById("WordInputBox").value.toLowerCase();e.indexOf("q")>-1||e.indexOf("v")>-1||e.indexOf("j")>-1||(document.getElementById("WordInputBox").value=tran.t("jqvText"))};t.onchange=a}else if("az"===e.value){bpOverlay.alphapos=0;var t=document.getElementById("WordInputBox"),a=function(){var e=document.getElementById("WordInputBox").value.toLowerCase();e[0]!==bpOverlay.alphabet[bpOverlay.alphapos]&&(document.getElementById("WordInputBox").value=tran.t("azText").replace("{l}",bpOverlay.alphabet[bpOverlay.alphapos]))};t.onchange=a}else if("xz"===e.value){var t=document.getElementById("WordInputBox"),a=function(){var e=document.getElementById("WordInputBox").value.toLowerCase();e.indexOf("x")>-1||e.indexOf("z")>-1||(document.getElementById("WordInputBox").value=tran.t("xzText"))};t.onchange=a}else document.getElementById("WordInputBox").onchange=""}),generateSettingsElement(tran.t("themeName"),{none:tran.t("themeOptions.none"),"https://raw.githubusercontent.com/MrInanimated/bp-overlay/master/themes/xmas/xmas.json":tran.t("themeOptions.xmas"),custom:tran.t("themeOptions.custom")},"themeSelect",function(){var e=document.getElementById("themeSelect");"none"===e.value?(loadCustomTheme(!1),document.getElementById("customThemeRow").style.display="none"):document.getElementById("customThemeRow").style.display="custom"===e.value?"":"none"}),function(){var e=document.getElementById("overlaySettingsTable"),t=document.createElement("TR");t.id="customThemeRow",t.style.display="none",e.appendChild(t);var a=document.createElement("TD");a.innerHTML=tran.t("customThemeName"),t.appendChild(a);var n=document.createElement("TD");t.appendChild(n);var o=document.createElement("INPUT");o.id="customThemeInput",n.appendChild(o)}(),generateSettingsElement(tran.t("particlesName"),{high:tran.t("particlesOptions.high"),low:tran.t("particlesOptions.low"),off:tran.t("particlesOptions.off")},"particleSelect",function(){var e=document.getElementById("particleSelect");bpOverlay.particleSpawnRate="high"===e.value?"high":"low"===e.value?"low":"none"}),generateSettingsElement(tran.t("notificationsName"),{on:tran.t("notificationOptions.on"),off:tran.t("notificationOptions.off")},"notificationsSelect",function(){var e=document.getElementById("notificationsSelect");bpOverlay.notifications="on"==e.value?!0:!1}),function(){var e=document.getElementById("overlaySettingsTable"),t=document.createElement("TR");e.appendChild(t);var a=document.createElement("TD");a.innerHTML=tran.t("notificationVolume"),t.appendChild(a);var n=document.createElement("TD");t.appendChild(n);var o=document.createElement("INPUT");o.id="notificationVolumeSlider",o.type="range",o.min=0,o.max=100,o.value=100,o.addEventListener("change",function(){bpOverlay.notificationSound.volume=o.value/100,bpOverlay.notificationSound.play()}),o.title=tran.t("notificationAliasInputTitle"),n.appendChild(o)}(),function(){var e=document.getElementById("overlaySettingsTable"),t=document.createElement("TR");t.id="notificationSettingsRow",e.appendChild(t);var a=document.createElement("TD");a.innerHTML=tran.t("notificationAlias"),a.title=tran.t("notificationAliasTitle"),t.appendChild(a);var n=document.createElement("TD");t.appendChild(n);var o=document.createElement("INPUT");o.id="notificationAliasInput",o.addEventListener("change",function(){var e=o.value.toLowerCase().split(";");bpOverlay.alias=[];for(var t=0;t<e.length;t++)""!==e[t]&&bpOverlay.alias.push(e[t])}),o.title=tran.t("notificationAliasInputTitle"),n.appendChild(o)}(),generateSettingsElement(tran.t("endGameNotification"),{on:tran.t("endGameNotificationOptions.on"),off:tran.t("endGameNotificationOptions.off")},"endGameNotificationSelect",function(){var e=document.getElementById("endGameNotificationSelect");bpOverlay.endGameNotification="on"==e.value?!0:!1}),document.getElementById("endGameNotificationSelect").value="off";var b=document.createElement("STYLE");b.textContent=".alphaColumn{display:none;}",document.head.appendChild(b),generateSettingsElement(tran.t("alphaRouletteName"),{on:tran.t("alphaRouletteOptions.on"),off:tran.t("alphaRouletteOptions.off")},"alphaRouletteSelect",function(){var e=document.getElementById("alphaRouletteSelect");b.textContent="on"==e.value?"":".alphaColumn{display:none;}"}),generateSettingsElement(tran.t("speechName"),{off:tran.t("speechOptions.off"),on:tran.t("speechOptions.on")},"speechSelect",function(){var e=document.getElementById("speechSelect");if("on"==e.value){var t,a=function(){t=setTimeout(function(){speechSynthesis.cancel()},13e3)},n=function(){clearTimeout(t)};channel.socket.on("chatMessage",function(e){var t=0;for(i=200;i<e.text.length;i+=200)for(j=i;j>=t;j-=1){if(" "===e.text[j]){barkmeow=new SpeechSynthesisUtterance(e.text.substring(t,j)),barkmeow.voice=speechSynthesis.getVoices().filter(function(e){return e.name==bpOverlay.speechName})[0],barkmeow.onstart=function(){a()},barkmeow.onend=function(){n()},speechSynthesis.speak(barkmeow),t=j;break}j==t&&(barkmeow=new SpeechSynthesisUtterance(e.text.substring(t,i)),barkmeow.voice=speechSynthesis.getVoices().filter(function(e){return e.name==bpOverlay.speechName})[0],barkmeow.onstart=function(){a()},barkmeow.onend=function(){n()},t=i)}barkmeow=new SpeechSynthesisUtterance(e.text.substring(t,e.text.length)),barkmeow.voice=speechSynthesis.getVoices().filter(function(e){return e.name==bpOverlay.speechName})[0],barkmeow.onstart=function(){a()},barkmeow.onend=function(){n()},speechSynthesis.speak(barkmeow),console.log(barkmeow)})}else channel.socket.listeners("chatMessage").pop()}),generateSettingsElement(tran.t("voiceSelect"),{us:tran.t("voiceOptions.us"),ukMale:tran.t("voiceOptions.ukMale"),ukFem:tran.t("voiceOptions.ukFem"),fran:tran.t("voiceOptions.fran")},"voiceSelect",function(){var e=document.getElementById("voiceSelect");bpOverlay.speechName="us"==e.value?"Google US English":"ukMale"==e.value?"Google UK English Male":"ukFem"==e.value?"Google UK English Female":"Google Français"}),document.getElementById("alphaRouletteSelect").value="off",wrapGameFunctions(),"playing"===channel.data.state&&generateActorConditions()};firstRunProcs(),setInterval(updateTime,1e3),channel.appendToChat("Info",tran.t("updateText"))};main()}},s=document.createElement("script");s.setAttribute("type","application/javascript"),s.textContent="("+source+")();",document.body.appendChild(s),document.body.removeChild(s);var validateThemeObj=function(e){var t=!0;if("object"==typeof e.images)for(var a in e.images)"object"!=typeof e.images[a]?(console.log("Error: image "+a+" is not an object."),t=!1):("string"!=typeof e.images[a].src&&(console.log("Error: invalid src provided in image "+a+"."),t=!1),"number"!=typeof e.images[a].xOffset&&"undefined"!=typeof e.images[a].xOffset&&(console.log("Error: invalid xOffset in image "+a+"."),t=!1),"number"!=typeof e.images[a].yOffset&&"undefined"!=typeof e.images[a].yOffset&&(console.log("Error: invalid yOffset in image "+a+"."),t=!1));else"undefined"!=typeof e.images&&(console.log("Error: images is not an object."),t=!1);"object"==typeof e.css?e.css.text?"string"!=typeof e.css.text&&(console.log("Error: invalid css.text provided"),t=!1):e.css.src?"string"!=typeof e.css.src&&(console.log("Error: invalid css source provided"),t=!1):(console.log("Error: css field declared, but no css provided"),t=!1):"undefined"!=typeof e.css&&(console.log("Error: css is not an object."),t=!1);var n=function(e){if("object"==typeof e){if("number"!=typeof e.min)return!1;if("number"!=typeof e.max)return!1}else if("number"!=typeof e)return!1;return!0};if("object"==typeof e.particles){if("[object Array]"===Object.prototype.toString.call(e.particles.emitters))for(a=0;a<e.particles.emitters.length;a++){var o=e.particles.emitters[a];"object"==typeof o.position?("number"!=typeof o.position.x&&(console.log("Error: particle.emitters["+a+"].position.x is not a number"),t=!1),"number"!=typeof o.position.y&&(console.log("Error: particle.emitters["+a+"].position.y is not a number"),t=!1),"undefined"!=typeof o.position.width&&"number"!=typeof o.position.width&&(console.log("Error: particle.emitters["+a+"].position.width is not a number"),t=!1),"undefined"!=typeof o.position.height&&"number"!=typeof o.position.height&&(console.log("Error: particle.emitters["+a+"].position.height is not a number"),t=!1)):(console.log("Error: particles.emitters["+a+"].position is not an object"),t=!1),"object"==typeof o.velocity?(n(o.velocity.x)||(console.log("Error: particles.emitters["+a+"].velocity.x is invalid"),t=!1),n(o.velocity.y)||(console.log("Error: particles.emitters["+a+"].velocity.y is invalid"),t=!1)):(console.log("Error: particles.emitters["+a+"].velocity is not an object"),t=!1),n(o.size)||(console.log("Error: particles.emitters["+a+"].size is invalid"),t=!1),n(o.rotation)||(console.log("Error: particles.emitters["+a+"].rotation is invalid"),t=!1),n(o.angularVelocity)||(console.log("Error: particles.emitters["+a+"].angularVelocity is invalid"),t=!1),"object"==typeof o.spawnRate?("number"!=typeof o.spawnRate.high&&(console.log("Error: particles.emitters["+a+"].spawnRate.high is invalid"),t=!1),"number"!=typeof o.spawnRate.low&&(console.log("Error: particles.emitters["+a+"].spawnRate.low is invalid"),t=!1)):(console.log("Error: particle.emitters["+a+"].spawnRate is not an object"),t=!1),"object"==typeof o.gravity?(n(o.gravity.x)||(console.log("Error: particles.emitters["+a+"].gravity.x is invalid"),t=!1),n(o.gravity.y)||(console.log("Error: particles.emitters["+a+"].gravity.y is invalid"),t=!1)):(console.log("Error: particles.emitters["+a+"].gravity is not an object"),t=!1)}else console.log("Error: particles.emitters is not an array"),t=!1;if("[object Array]"===Object.prototype.toString.call(e.particles.images))for(a=0;a<e.particles.images.length;a++)"string"!=typeof e.particles.images[a]&&(console.log("Error: particles.images["+a+"] is not a string"),t=!1)}else"undefined"!=typeof e.particles&&(console.log("Error: particles is not an object"),t=!1);var r=function(e){return"object"!=typeof e?!1:"undefined"!=typeof e.color&&"string"!=typeof e.color?!1:"undefined"!=typeof e.fontFamily&&"string"!=typeof e.fontFamily?!1:"undefined"!=typeof e.fontSize&&"number"!=typeof e.fontSize?!1:"undefined"!=typeof e.majorFontSize&&"number"!=typeof e.majorFontSize?!1:"undefined"!=typeof e.minorFontSize&&"number"!=typeof e.minorFontSize?!1:!0},i=["statusText","promptText","wordText","highlightedText","bonusLetterText"];if("object"==typeof e.textStyles)for(a=0;a<i.length;a++)r(e.textStyles[i[a]])||(console.log("Error: textStyles."+i[a]+" is invalid or has some invalid parameters."),t=!1);else"undefined"!=typeof e.textStyles&&(console.log("Error: textStyles is not an object."),t=!1);return t},json_parse=function(){"use strict";var e,t,a,n,o={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"	"},r=function(t){throw{name:"SyntaxError",message:t,at:e,text:a}},i=function(n){return n&&n!==t&&r("Expected '"+n+"' instead of '"+t+"'"),t=a.charAt(e),e+=1,t},s=function(){var e,a="";for("-"===t&&(a="-",i("-"));t>="0"&&"9">=t;)a+=t,i();if("."===t)for(a+=".";i()&&t>="0"&&"9">=t;)a+=t;if("e"===t||"E"===t)for(a+=t,i(),("-"===t||"+"===t)&&(a+=t,i());t>="0"&&"9">=t;)a+=t,i();return e=+a,isFinite(e)?e:void r("Bad number")},l=function(){var e,a,n,s="";if('"'===t)for(;i();){if('"'===t)return i(),s;if("\\"===t)if(i(),"u"===t){for(n=0,a=0;4>a&&(e=parseInt(i(),16),isFinite(e));a+=1)n=16*n+e;s+=String.fromCharCode(n)}else{if("string"!=typeof o[t])break;s+=o[t]}else s+=t}r("Bad string")},c=function(){for(;t&&" ">=t;)i()},d=function(){switch(t){case"t":return i("t"),i("r"),i("u"),i("e"),!0;case"f":return i("f"),i("a"),i("l"),i("s"),i("e"),!1;case"n":return i("n"),i("u"),i("l"),i("l"),null}r("Unexpected '"+t+"'")},u=function(){var e=[];if("["===t){if(i("["),c(),"]"===t)return i("]"),e;for(;t;){if(e.push(n()),c(),"]"===t)return i("]"),e;i(","),c()}}r("Bad array")},p=function(){var e,a={};if("{"===t){if(i("{"),c(),"}"===t)return i("}"),a;for(;t;){if(e=l(),c(),i(":"),Object.hasOwnProperty.call(a,e)&&r('Duplicate key "'+e+'"'),a[e]=n(),c(),"}"===t)return i("}"),a;i(","),c()}}r("Bad object")};return n=function(){switch(c(),t){case"{":return p();case"[":return u();case'"':return l();case"-":return s();default:return t>="0"&&"9">=t?s():d()}},function(o,i){var s;return a=o,e=0,t=" ",s=n(),c(),t&&r("Syntax error"),"function"==typeof i?function l(e,t){var a,n,o=e[t];if(o&&"object"==typeof o)for(a in o)Object.prototype.hasOwnProperty.call(o,a)&&(n=l(o,a),void 0!==n?o[a]=n:delete o[a]);return i.call(e,t,o)}({"":s},""):s}}(),loadAndApplyTheme=function(e){GM_xmlhttpRequest({method:"GET",url:e,onload:function(e){try{var t=json_parse(e.responseText)}catch(a){return alert("Invalid JSON."),void console.log(a)}if(validateThemeObj(t)){var n=document.createElement("script");n.setAttribute("type","application/javascript"),n.textContent="loadCustomTheme(false); loadCustomTheme("+e.responseText+")",document.body.appendChild(n),document.body.removeChild(n)}else alert("Invalid theme specified. Check the console for what is invalid.")},onerror:function(){alert("Error loading "+e)}})},attachToSettings=function(){if(document.getElementById("containerSelect")&&document.getElementById("twitchEmoteSelect")&&document.getElementById("adventureSetting")&&document.getElementById("themeSelect")&&document.getElementById("customThemeInput")&&document.getElementById("notificationsSelect")&&document.getElementById("notificationVolumeSlider")&&document.getElementById("notificationAliasInput")&&document.getElementById("endGameNotificationSelect")&&document.getElementById("particleSelect")&&document.getElementById("chatDownButton")&&document.getElementById("autoFocusButton")&&document.getElementById("dragButton")&&document.getElementById("alphaRouletteSelect")){var e=document.getElementById("containerSelect"),t=document.getElementById("twitchEmoteSelect"),a=document.getElementById("adventureSetting"),n=document.getElementById("themeSelect"),o=document.getElementById("customThemeInput"),r=document.getElementById("notificationsSelect"),i=document.getElementById("notificationAliasInput"),s=document.getElementById("notificationVolumeSlider"),l=document.getElementById("endGameNotificationSelect"),c=document.getElementById("particleSelect"),d=document.getElementById("chatDownButton"),u=document.getElementById("autoFocusButton"),p=document.getElementById("dragButton"),m=document.getElementById("alphaRouletteSelect"),h=function(e,t,a){if(GM_getValue(t,a)!==e.value){e.value=GM_getValue(t,a);var n=new Event("change");e.dispatchEvent(n)}},g=function(e,t,a){if(GM_getValue(t,a)!==e.dataset.state){var n=new MouseEvent("click");e.dispatchEvent(n)}};if(h(e,"containerState","compact"),h(t,"twitchEmoteState","on"),h(a,"adventureState","off"),h(r,"notificationsState","on"),h(i,"notificationAlias",""),h(l,"endGameNotificationSetting","off"),h(m,"alphaRouletteState","off"),h(c,"particleState","high"),g(d,"chatDownState","true"),g(u,"autoFocusState","true"),g(p,"dragState","false"),GM_getValue("notificationVolume",100)!==s.value){s.value=GM_getValue("notificationVolume",100);var f=document.createElement("script");f.textContent="bpOverlay.notificationSound.volume="+s.value/100,document.body.appendChild(f),document.body.removeChild(f)}e.addEventListener("change",function(){setTimeout(function(){GM_setValue("containerState",e.value)},100)}),t.addEventListener("change",function(){setTimeout(function(){GM_setValue("twitchEmoteState",t.value)},100)}),a.addEventListener("change",function(){setTimeout(function(){GM_setValue("adventureState",a.value)},100)}),r.addEventListener("change",function(){setTimeout(function(){GM_setValue("notificationsState",r.value)},100)}),i.addEventListener("change",function(){setTimeout(function(){GM_setValue("notificationAlias",i.value)},100)}),s.addEventListener("change",function(){setTimeout(function(){GM_setValue("notificationVolume",s.value)},100)}),l.addEventListener("change",function(){setTimeout(function(){GM_setValue("endGameNotificationSetting",l.value)},100)}),c.addEventListener("change",function(){setTimeout(function(){GM_setValue("particleState",c.value)},100)}),m.addEventListener("change",function(){setTimeout(function(){GM_setValue("alphaRouletteState",m.value)},100)}),d.addEventListener("click",function(){setTimeout(function(){GM_setValue("chatDownState",d.dataset.state)},100)}),u.addEventListener("click",function(){setTimeout(function(){GM_setValue("autoFocusState",u.dataset.state)},100)}),p.addEventListener("click",function(){setTimeout(function(){GM_setValue("dragState",p.dataset.state)},100)}),n.addEventListener("change",function(){"none"!==n.value&&"custom"!==n.value?(loadAndApplyTheme(n.value),GM_setValue("theme",n.value),GM_setValue("customTheme","none"),o.value=""):"none"===n.value&&(GM_setValue("theme","none"),GM_setValue("customTheme","none"))}),o.addEventListener("keypress",function(e){13===e.keyCode&&(loadAndApplyTheme(o.value),GM_setValue("theme","custom"),GM_setValue("customTheme",o.value))}),h(n,"theme","none"),"none"!==GM_getValue("customTheme","none")&&(GM_setValue("theme","custom"),o.value=GM_getValue("customTheme","none"),loadAndApplyTheme(o.value))}else console.log("Cannot attach, trying again in a second"),setTimeout(attachToSettings,1e3)};attachToSettings();
