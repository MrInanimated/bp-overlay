// ==UserScript==
// @name         BombParty Overlay
// @version      1.3.7
// @description  Overlay + Utilities for BombParty!
// @icon         https://raw.githubusercontent.com/MrInanimated/bp-overlay/master/dist/icon.png
// @icon64       https://raw.githubusercontent.com/MrInanimated/bp-overlay/master/dist/icon64.png
// @downloadURL  https://github.com/MrInanimated/bp-overlay/raw/master/dist/bpoverlay.user.js
// @author       Tianlin Zhang and Skandalabrandur
// @match        http://bombparty.sparklinlabs.com/play/*
// @resource     twitch_global http://twitchemotes.com/global.json
// @resource     twitch_subscriber http://twitchemotes.com/subscriber.json
// @resource     autoScrollOn https://raw.githubusercontent.com/MrInanimated/bp-overlay/master/dist/chatdown.png
// @resource     autoScrollOff https://raw.githubusercontent.com/MrInanimated/bp-overlay/master/dist/chatdownoff.png
// @resource     autoFocusOn https://raw.githubusercontent.com/MrInanimated/bp-overlay/master/dist/focusOn.png
// @resource     autoFocusOff https://raw.githubusercontent.com/MrInanimated/bp-overlay/master/dist/focusOff.png
// @resource     dragOff https://raw.githubusercontent.com/MrInanimated/bp-overlay/master/dist/dragOff.png
// @resource     dragOn https://raw.githubusercontent.com/MrInanimated/bp-overlay/master/dist/dragOn.png
// @resource     hideDeadOn https://raw.githubusercontent.com/MrInanimated/bp-overlay/master/dist/hideDeadOn.png
// @resource     hideDeadOff https://raw.githubusercontent.com/MrInanimated/bp-overlay/master/dist/hideDeadOff.png
// @grant        GM_getResourceText
// @grant        GM_getResourceURL
// @grant        GM_getValue
// @grant        GM_setValue
// @grant        GM_xmlhttpRequest
// ==/UserScript==


// Un-minified JS, available at https://github.com/MrInanimated/bp-overlay/blob/master/dist/bpoverlay.user.js
var tg=GM_getResourceText("twitch_global");var ts=GM_getResourceText("twitch_subscriber");var te=document.createElement("script");te.setAttribute("type","application/javascript");te.textContent="var twitch_global = "+tg+";var twitch_subscriber = "+ts+';var bpImgUrls = {	autoScrollOn : "'+GM_getResourceURL("autoScrollOn")+'",	autoScrollOff : "'+GM_getResourceURL("autoScrollOff")+'",	autoFocusOn : "'+GM_getResourceURL("autoFocusOn")+'",	autoFocusOff : "'+GM_getResourceURL("autoFocusOff")+'",	dragOff : "'+GM_getResourceURL("dragOff")+'",	dragOn : "'+GM_getResourceURL("dragOn")+'",	hideDeadOn : "'+GM_getResourceURL("hideDeadOn")+'",	hideDeadOff : "'+GM_getResourceURL("hideDeadOff")+'",};';document.body.appendChild(te);document.body.removeChild(te);var source=function(){if(window.hasOwnProperty("BPOverlayHasRun")){}else{window.BPOverlayHasRun=true;var e=function(){function f(){if(bpOverlay.dragboxHasBeenCreated){var e=window.innerHeight,t=window.innerWidth;var n=document.getElementById("infoBox");var r=n.clientWidth;var i=n.clientHeight;var s=document.getElementById("dragonDrop");var o=parseInt(s.style.left);var u=parseInt(s.style.top);if(r+o>t){s.style.left=t-r+"px"}if(u<0){s.style.top="0px"}else if(i+u>e){s.style.top=e-i+"px"}}}function l(e){var t=window.getComputedStyle(e.target,null);e.dataTransfer.setData("text/plain",parseInt(t.getPropertyValue("left"),10)-e.clientX+","+(parseInt(t.getPropertyValue("top"),10)-e.clientY))}function c(e){e.preventDefault();return false}function h(e){var t=e.dataTransfer.getData("text/plain").split(",");var n=document.getElementById("dragonDrop");var r=e.clientX+parseInt(t[0],10);var i=e.clientY+parseInt(t[1],10);var s=window.innerHeight,o=window.innerWidth;var u=document.getElementById("infoBox").clientHeight;var a=document.getElementById("infoBox").clientWidth;if(r<0){n.style.left="0px"}else if(r+a>o){n.style.left=o-a+"px"}else{n.style.left=r+"px"}if(i<0){n.style.top="0px"}else if(i+u>s){n.style.top=s-u+"px"}else{n.style.top=i+"px"}e.preventDefault();return false}if(!(window.hasOwnProperty("channel")&&channel.socket&&channel.data&&channel.appendToChat&&channel.socket.listeners("setActivePlayerIndex").length&&channel.socket.listeners("winWord").length&&channel.socket.listeners("setPlayerLives").length&&channel.socket.listeners("setPlayerState").length&&channel.socket.listeners("endGame").length&&window.hasOwnProperty("JST")&&JST["nuclearnode/chatMessage"]&&document.getElementById("Sidebar")&&document.getElementById("ChatLog"))){console.log("Everything's not loaded yet, trying again in a second...");setTimeout(e,1e3);return}!function(e,t){"function"==typeof define&&define.amd?define([],function(){return e.returnExportsGlobal=t()}):"object"==typeof exports?module.exports=t():e.Autolinker=t()}(this,function(){var e=function(t){e.Util.assign(this,t),this.matchValidator=new e.MatchValidator};return e.prototype={constructor:e,urls:!0,email:!0,twitter:!0,newWindow:!0,stripPrefix:!0,className:"",htmlCharacterEntitiesRegex:/(&nbsp;|&#160;|&lt;|&#60;|&gt;|&#62;)/gi,matcherRegex:function(){var e=/(^|[^\w])@(\w{1,15})/,t=/(?:[\-;:&=\+\$,\w\.]+@)/,n=/(?:[A-Za-z][-.+A-Za-z0-9]+:(?![A-Za-z][-.+A-Za-z0-9]+:\/\/)(?!\d+\/?)(?:\/\/)?)/,r=/(?:www\.)/,i=/[A-Za-z0-9\.\-]*[A-Za-z0-9\-]/,s=/\.(?:international|construction|contractors|enterprises|photography|productions|foundation|immobilien|industries|management|properties|technology|christmas|community|directory|education|equipment|institute|marketing|solutions|vacations|bargains|boutique|builders|catering|cleaning|clothing|computer|democrat|diamonds|graphics|holdings|lighting|partners|plumbing|supplies|training|ventures|academy|careers|company|cruises|domains|exposed|flights|florist|gallery|guitars|holiday|kitchen|neustar|okinawa|recipes|rentals|reviews|shiksha|singles|support|systems|agency|berlin|camera|center|coffee|condos|dating|estate|events|expert|futbol|kaufen|luxury|maison|monash|museum|nagoya|photos|repair|report|social|supply|tattoo|tienda|travel|viajes|villas|vision|voting|voyage|actor|build|cards|cheap|codes|dance|email|glass|house|mango|ninja|parts|photo|shoes|solar|today|tokyo|tools|watch|works|aero|arpa|asia|best|bike|blue|buzz|camp|club|cool|coop|farm|fish|gift|guru|info|jobs|kiwi|kred|land|limo|link|menu|mobi|moda|name|pics|pink|post|qpon|rich|ruhr|sexy|tips|vote|voto|wang|wien|wiki|zone|bar|bid|biz|cab|cat|ceo|com|edu|gov|int|kim|mil|net|onl|org|pro|pub|red|tel|uno|wed|xxx|xyz|ac|ad|ae|af|ag|ai|al|am|an|ao|aq|ar|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cu|cv|cw|cx|cy|cz|de|dj|dk|dm|do|dz|ec|ee|eg|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mk|ml|mm|mn|mo|mp|mq|mr|ms|mt|mu|mv|mw|mx|my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|ps|pt|pw|py|qa|re|ro|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|sk|sl|sm|sn|so|sr|st|su|sv|sx|sy|sz|tc|td|tf|tg|th|tj|tk|tl|tm|tn|to|tp|tr|tt|tv|tw|tz|ua|ug|uk|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|za|zm|zw)\b/,o=/[\-A-Za-z0-9+&@#\/%=~_()|'$*\[\]?!:,.;]*[\-A-Za-z0-9+&@#\/%=~_()|'$*\[\]]/;return new RegExp(["(",e.source,")","|","(",t.source,i.source,s.source,")","|","(","(?:","(",n.source,i.source,")","|","(?:","(.?//)?",r.source,i.source,")","|","(?:","(.?//)?",i.source,s.source,")",")","(?:"+o.source+")?",")"].join(""),"gi")}(),charBeforeProtocolRelMatchRegex:/^(.)?\/\//,link:function(t){var n=this,r=this.getHtmlParser(),i=this.htmlCharacterEntitiesRegex,s=0,o=[];return r.parse(t,{processHtmlNode:function(e,t,n){"a"===t&&(n?s=Math.max(s-1,0):s++),o.push(e)},processTextNode:function(t){if(0===s)for(var r=e.Util.splitAndCapture(t,i),u=0,a=r.length;a>u;u++){var f=r[u],l=n.processTextNode(f);o.push(l)}else o.push(t)}}),o.join("")},getHtmlParser:function(){var t=this.htmlParser;return t||(t=this.htmlParser=new e.HtmlParser),t},getTagBuilder:function(){var t=this.tagBuilder;return t||(t=this.tagBuilder=new e.AnchorTagBuilder({newWindow:this.newWindow,truncate:this.truncate,className:this.className})),t},processTextNode:function(e){var t=this;return e.replace(this.matcherRegex,function(e,n,r,i,s,o,u,a,f){var l=t.processCandidateMatch(e,n,r,i,s,o,u,a,f);if(l){var c=t.createMatchReturnVal(l.match,l.matchStr);return l.prefixStr+c+l.suffixStr}return e})},processCandidateMatch:function(t,n,r,i,s,o,u,a,f){var l,c=a||f,h="",p="";if(n&&!this.twitter||s&&!this.email||o&&!this.urls||!this.matchValidator.isValidMatch(o,u,c))return null;if(this.matchHasUnbalancedClosingParen(t)&&(t=t.substr(0,t.length-1),p=")"),s)l=new e.match.Email({matchedText:t,email:s});else if(n)r&&(h=r,t=t.slice(1)),l=new e.match.Twitter({matchedText:t,twitterHandle:i});else{if(c){var d=c.match(this.charBeforeProtocolRelMatchRegex)[1]||"";d&&(h=d,t=t.slice(1))}l=new e.match.Url({matchedText:t,url:t,protocolUrlMatch:!!u,protocolRelativeMatch:!!c,stripPrefix:this.stripPrefix})}return{prefixStr:h,suffixStr:p,matchStr:t,match:l}},matchHasUnbalancedClosingParen:function(e){var t=e.charAt(e.length-1);if(")"===t){var n=e.match(/\(/g),r=e.match(/\)/g),i=n&&n.length||0,s=r&&r.length||0;if(s>i)return!0}return!1},createMatchReturnVal:function(t,n){var r;if(this.replaceFn&&(r=this.replaceFn.call(this,this,t)),"string"==typeof r)return r;if(r===!1)return n;if(r instanceof e.HtmlTag)return r.toString();var i=this.getTagBuilder(),s=i.build(t);return s.toString()}},e.link=function(t,n){var r=new e(n);return r.link(t)},e.match={},e.Util={abstractMethod:function(){throw"abstract"},assign:function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e},extend:function(t,n){var r=t.prototype,i=function(){};i.prototype=r;var s;s=n.hasOwnProperty("constructor")?n.constructor:function(){r.constructor.apply(this,arguments)};var o=s.prototype=new i;return o.constructor=s,o.superclass=r,delete n.constructor,e.Util.assign(o,n),s},ellipsis:function(e,t,n){return e.length>t&&(n=null==n?"..":n,e=e.substring(0,t-n.length)+n),e},indexOf:function(e,t){if(Array.prototype.indexOf)return e.indexOf(t);for(var n=0,r=e.length;r>n;n++)if(e[n]===t)return n;return-1},splitAndCapture:function(e,t){if(!t.global)throw new Error("`splitRegex` must have the 'g' flag set");for(var n,r=[],i=0;n=t.exec(e);)r.push(e.substring(i,n.index)),r.push(n[0]),i=n.index+n[0].length;return r.push(e.substring(i)),r}},e.HtmlParser=e.Util.extend(Object,{htmlRegex:function(){var e=/[0-9a-zA-Z][0-9a-zA-Z:]*/,t=/[^\s\0"'>\/=\x01-\x1F\x7F]+/,n=/(?:".*?"|'.*?'|[^'"=<>`\s]+)/,r=t.source+"(?:\\s*=\\s*"+n.source+")?";return new RegExp(["(?:","<(!DOCTYPE)","(?:","\\s+","(?:",r,"|",n.source+")",")*",">",")","|","(?:","<(/)?","("+e.source+")","(?:","\\s+",r,")*","\\s*/?",">",")"].join(""),"gi")}(),parse:function(e,t){t=t||{};for(var n,r=t.processHtmlNode||function(){},i=t.processTextNode||function(){},s=this.htmlRegex,o=0;null!==(n=s.exec(e));){var u=n[0],a=n[1]||n[3],f=!!n[2],l=e.substring(o,n.index);l&&i(l),r(u,a.toLowerCase(),f),o=n.index+u.length}if(o<e.length){var c=e.substring(o);c&&i(c)}}}),e.HtmlTag=e.Util.extend(Object,{whitespaceRegex:/\s+/,constructor:function(t){e.Util.assign(this,t),this.innerHtml=this.innerHtml||this.innerHTML},setTagName:function(e){return this.tagName=e,this},getTagName:function(){return this.tagName||""},setAttr:function(e,t){var n=this.getAttrs();return n[e]=t,this},getAttr:function(e){return this.getAttrs()[e]},setAttrs:function(t){var n=this.getAttrs();return e.Util.assign(n,t),this},getAttrs:function(){return this.attrs||(this.attrs={})},setClass:function(e){return this.setAttr("class",e)},addClass:function(t){for(var n,r=this.getClass(),i=this.whitespaceRegex,s=e.Util.indexOf,o=r?r.split(i):[],u=t.split(i);n=u.shift();)-1===s(o,n)&&o.push(n);return this.getAttrs()["class"]=o.join(" "),this},removeClass:function(t){for(var n,r=this.getClass(),i=this.whitespaceRegex,s=e.Util.indexOf,o=r?r.split(i):[],u=t.split(i);o.length&&(n=u.shift());){var a=s(o,n);-1!==a&&o.splice(a,1)}return this.getAttrs()["class"]=o.join(" "),this},getClass:function(){return this.getAttrs()["class"]||""},hasClass:function(e){return-1!==(" "+this.getClass()+" ").indexOf(" "+e+" ")},setInnerHtml:function(e){return this.innerHtml=e,this},getInnerHtml:function(){return this.innerHtml||""},toString:function(){var e=this.getTagName(),t=this.buildAttrsStr();return t=t?" "+t:"",["<",e,t,">",this.getInnerHtml(),"</",e,">"].join("")},buildAttrsStr:function(){if(!this.attrs)return"";var e=this.getAttrs(),t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n+'="'+e[n]+'"');return t.join(" ")}}),e.MatchValidator=e.Util.extend(Object,{invalidProtocolRelMatchRegex:/^[\w]\/\//,hasFullProtocolRegex:/^[A-Za-z][-.+A-Za-z0-9]+:\/\//,uriSchemeRegex:/^[A-Za-z][-.+A-Za-z0-9]+:/,hasWordCharAfterProtocolRegex:/:[^\s]*?[A-Za-z]/,isValidMatch:function(e,t,n){return t&&!this.isValidUriScheme(t)||this.urlMatchDoesNotHaveProtocolOrDot(e,t)||this.urlMatchDoesNotHaveAtLeastOneWordChar(e,t)||this.isInvalidProtocolRelativeMatch(n)?!1:!0},isValidUriScheme:function(e){var t=e.match(this.uriSchemeRegex)[0];return"javascript:"!==t&&"vbscript:"!==t},urlMatchDoesNotHaveProtocolOrDot:function(e,t){return!(!e||t&&this.hasFullProtocolRegex.test(t)||-1!==e.indexOf("."))},urlMatchDoesNotHaveAtLeastOneWordChar:function(e,t){return e&&t?!this.hasWordCharAfterProtocolRegex.test(e):!1},isInvalidProtocolRelativeMatch:function(e){return!!e&&this.invalidProtocolRelMatchRegex.test(e)}}),e.AnchorTagBuilder=e.Util.extend(Object,{constructor:function(t){e.Util.assign(this,t)},build:function(t){var n=new e.HtmlTag({tagName:"a",attrs:this.createAttrs(t.getType(),t.getAnchorHref()),innerHtml:this.processAnchorText(t.getAnchorText())});return n},createAttrs:function(e,t){var n={href:t},r=this.createCssClass(e);return r&&(n["class"]=r),this.newWindow&&(n.target="_blank"),n},createCssClass:function(e){var t=this.className;return t?t+" "+t+"-"+e:""},processAnchorText:function(e){return e=this.doTruncate(e)},doTruncate:function(t){return e.Util.ellipsis(t,this.truncate||Number.POSITIVE_INFINITY)}}),e.match.Match=e.Util.extend(Object,{constructor:function(t){e.Util.assign(this,t)},getType:e.Util.abstractMethod,getMatchedText:function(){return this.matchedText},getAnchorHref:e.Util.abstractMethod,getAnchorText:e.Util.abstractMethod}),e.match.Email=e.Util.extend(e.match.Match,{getType:function(){return"email"},getEmail:function(){return this.email},getAnchorHref:function(){return"mailto:"+this.email},getAnchorText:function(){return this.email}}),e.match.Twitter=e.Util.extend(e.match.Match,{getType:function(){return"twitter"},getTwitterHandle:function(){return this.twitterHandle},getAnchorHref:function(){return"https://twitter.com/"+this.twitterHandle},getAnchorText:function(){return"@"+this.twitterHandle}}),e.match.Url=e.Util.extend(e.match.Match,{urlPrefixRegex:/^(https?:\/\/)?(www\.)?/i,protocolRelativeRegex:/^\/\//,protocolPrepended:!1,getType:function(){return"url"},getUrl:function(){var e=this.url;return this.protocolRelativeMatch||this.protocolUrlMatch||this.protocolPrepended||(e=this.url="http://"+e,this.protocolPrepended=!0),e},getAnchorHref:function(){var e=this.getUrl();return e.replace(/&/g,"&")},getAnchorText:function(){var e=this.getUrl();return this.protocolRelativeMatch&&(e=this.stripProtocolRelativePrefix(e)),this.stripPrefix&&(e=this.stripUrlPrefix(e)),e=this.removeTrailingSlash(e)},stripUrlPrefix:function(e){return e.replace(this.urlPrefixRegex,"")},stripProtocolRelativePrefix:function(e){return e.replace(this.protocolRelativeRegex,"")},removeTrailingSlash:function(e){return"/"===e.charAt(e.length-1)&&(e=e.slice(0,-1)),e}}),e});bpOverlay={playerNames:{},playerAuthId:{},lostLives:{},flips:{},uFlips:{},wordCount:0,startTime:0,timeText:"",dragBoxHasBeenCreated:false,boxHasBeenCreated:false,firstRun:true,prevPlayerNames:{},prevLostLives:{},prevFlips:{},prevUFlips:{},prevTimeText:"",prevWordCount:0,hideDead:false,dragonDrop:false,autoScroll:true,autoFocus:true,focusNext:false,twitchOn:true,markupOn:true,adventureTextMode:false,adventureFirstRun:false,adventureLevels:["A noob","A beginner","A novice","A student of flips","A graduated student of flips","An expert flipper","An incredible flipper","A master flipper","A scrub tier immortal","A near immortal","An immortal","A massive flipping faggot","A strong contender to the 'hang in there kitty'","An immeasurable faggot of flips","A blackhole tier faggot","A legendary immortal faggot flipper","A supermassive faggot with more flips than a herd of dolphins","Silly rabbit. Flips are for kids!","An undefeatable flipping gaylord of +5 anal strength","An ascended immortal queen faggot cockmunch godly overlord of flips","Zip zop zippety boop flip floop","You're now the gayest man on earth","Aren't you fagged out after all that flipping?","A lifesize Johnboat","A lifesize Catboat","The Jesus figure in the underworld of extreme flip fetish","On fliproids!","Why don't you slip into something more comfortable... like a coma?","A divine elder scrub god that manifests himself as fine-cuisine salt","The nicest guy. Didn't expect that did you?","Hungry hungry heart hoarder!","A bird in the hand is worth zemstvo in the quush","You're good. Actually very good. Goddamn","Still going. Holy crap!","Your Anaconda dont want none unless you got equivocations hun","A budding plenipotentiary","Antidisestablishmentarinism in the flesh","Suffering from pseudopseudohypoparathyroidism","Arrete les flips tu connard!","A disciple of Pingu","A man of a thousand flips... well... 40","The god of bombparty","Insert Douglas Adams reference here because 42 flips","An Alpaca. Yes. An Alpaca. The flippest of animals besides giraffes","A giraffe. The flippest of the animals in the animal kingdom","You deserve a movie about you. The title 'Rainman' is taken though","If faggots were mountains, you'd be a volcano!"],alphabet:["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],alphapos:0,isThemed:false,particleSpawnRate:"high"};gameImages={};var t=["avatarShadow","heart","heartEmpty","arrow","bomb","sparkle","avatarPlaceHolder","letter"];var n={};var r={};var s={};var o=document.getElementById("GameCanvas").getContext("2d");var u={format:function(e,t){return e.replace(/{(\d+)}/g,function(e,n){return typeof t[n]!="undefined"?t[n]:e})},chooseText:function(e){var t=Array.prototype.slice.call(arguments,1);var n=this.textBanks[e];var r=n[Math.floor(Math.random()*n.length)];return this.format(r,t)},textBanks:{newRound:["Hark, the wheel turns yet again!","Lo and behold, a new round has cometh!","The crack of a new bomb, stand ready and begin the new day!","The whole bomb's a stage, and all the men and women merely nerds!","Give heed! The wordgrimage is set about, selectees!","With thine vocable, set forth and slay that which is fragmentary!","Words are swords, prompts be stomped!","Sticks and stones will break thy bones / And prompts will surely kill thee!"],userTurn:["It is thy turn, squire. You are facing off against {0}. Do thine worst!","A vile horror seeks thee. What is thine plan for {0}?","Nay, {0} fixes to tender thine flame. Take action!","A wild {0} appears!","Shalt thou stand and accomplish nothing against {0}?","{0} is about to wound thee. Time for a curt attack!","Heedeth thou the mighty {0}! Distress or scuffle is forthcoming!","Art thou harefooted or harebrained! Observe, it is {0}!"],playerTurn:["The heroic, {0}, faces the mighty {1}.","A ferocious roar as {1} corners {0}!","{0} needeth stand firm or be struck by {1}","{1} hath hunger who {0} might satisfy, lest!","{0} faces down the rat that is {1}!","{0} challenges the verminous {1}!","Behold the ravenous {1}! Will {0} succeed?","{0} versus {1}! The trepidation is palpable!"],userLevelUp:["LEVEL UP: Thou art now {0}","UPLEVEL : Now thou art {0}","RISE SIR, AS '{0}'","YOU FIT A NEW TITLE: {0}","THOU HAST EVOLVED INTO {0}","EXPERIENCE MOLDS YOU INTO {0}","YOU FEEL STRONGER: You become '{0}'","REJOICE, YOU ARE: {0}"],levelUp:["{0} levelled up to {1}","{0} has become {1}","{0} is now titled {1}","{0} has a new name: {1}","There is now a '{1}' among us","{0} is levelling up. What's your excuse, faggoth?","Out of his cocoon, {0} crawls like a majestic buttefly. How can I compare 'levelling up' to a summer's day?","{0} is evolving! Don't cream your pants, Pokémon faggots!"],userWinWord:["Thou hast slain the beast with your {0} and gained {1} EXP!","The hellion shatters for thine knowledge is vast. A well deserved {1} EXP!","Smite triumphed over bite! The prompt is no more. You gain {1} EXP!","Twas foolish of the beast to underestimate you. You gain {1} EXP","By Jove, the miscreant is rend like a brittle biscuit from your wallop. I say, good show!","No mercy have thou for these ogres. Let {0} be a lesson. You gain {1} EXP","Blasted vermin recoil in fear at thine mighty {0}. {1} EXP to thee!","Idle barking is met with a firm {0}."],winWord:["{0} has killed the beast with the mighty shout {1} and gained {2} EXP!","{0} fears no ghosts. His guiding {1} has fled them from the shadows!","{1}, an apt warcry from {0} who gained {2} EXP!","{0} decimates the hoodlum with {1} and gains {2} EXP","{1}, and then the dragon is no more! {0} feels stronger by {2} points!","{0} delivers the final blow to the whale with his {1}!","{1} was {0}'s weapon of choice and he earns {2} EXP","{0} shows no mercy and swings his {1}!"],userLostLife:["Thine ignorance woundeth and thou hast been hurt","Incompetent fool, you were lacerated by a mere rodent!","Thou areth assrapeth so fervently you lose heart!","If thy stuttereth again, thou shalt surely receive another blow such as this!","Nay, thou hast been set upon and crushed by that wild thing!","Is thy fighting as good as thy 'not-being-a-faggot' skill? Thine heart bleeds!","Thine tongue utters nothing and so thou art skewered like a pig! The agony!","Thou art badly contused by the assailing prompt. Man up or die, cutter!"],lostLife:["Alas... for poor {0} hath been hurt","{0} has been struck to the ground!","{0} cries can be heard echoing through these halls!","{0} receives hefty damage!","The horror kill and goes forth to claim its next victim","Sacre bleu. Les monstrosite c'est trop. {0} ne pas victoirement!","Don't look. {0} was badly mauled!","Oh lord gawd. {0} got roughed up!","{0} was generously harmed!"],userDeath:["and a grave loss for thou art dead. {0}, may thee rest in peace!","yet-th, thineth lifeth hateth endeth. Noth. Whyth?","but this is the end for you. Rest in pieces, sweet prince","however you face oblivion.","and thine life flasheth before thine eyes and thou realizes what a dead faggot thou art!","now you have left the realm of the living and enter the realm of spectators!","here, you expire like milk and smell like it too! Smelly dead {0}!","but bonk bonk you conk into the casket. The wonk was too stronk!"],death:["and weepeth, thee morn, for {0} hath left yonder mortal coil!","{0} exits the stage!","{0} is snuffed like a candle","{0} is no more, like, jeez, got dun dead good!","meow meow meow 'COMPLETELY DEAD' meow meow '{0}'","{0} kicks the bucket, knocks it over and swallows shit!","{0}, oh, in the prime of his 'not being able to answer prompts like the faggot he is', is deceased!","{0}, bites the dust, goes the way of all flesh, gives up the ghost, drops off. You know what I mean"],endRound:["All things must end and so it does with {0}!","The ordeal is over!","{0} was the death of all but one!","The seemingly unending wave of prompts comes to a halt!","Now, caged are the dogs of war!","And on that bombshell, {0}, we have to end!","Many have fallen! But not all!","Nothing lasts forever!, Yet..."],winner:["Rising from the ashes of felled brethren is the victorious {0}!","A knight in tested armor, still breathing, the glorious {0}!","Praise be the heroic {0} for that human/otherkin/refridgerator has not be vanquished!","The surviving faggot was indeed {0}","Ahoyhoy and a hullo for the indissoluble {0}","Is it a bird? Is it a plane? Whatever it is, it's {0}","Doctors hate {0}! The secret doctors don't want you to know is \"don't be a scrub\"!","{0} the unending, the ceaseless, the permanent, the unfading; the sole survivor!"]}};var a=function(e,t){for(x in t){e[x]=t[x]}return e};bpOverlayImgs={on:a(document.createElement("img"),{width:30,height:30,src:bpImgUrls.autoScrollOn}),off:a(document.createElement("img"),{width:30,height:30,src:bpImgUrls.autoScrollOff}),autoFocusOn:a(document.createElement("img"),{width:30,height:30,src:bpImgUrls.autoFocusOn}),autoFocusOff:a(document.createElement("img"),{width:30,height:30,src:bpImgUrls.autoFocusOff}),dragOff:a(document.createElement("img"),{width:30,height:30,src:bpImgUrls.dragOff}),dragOn:a(document.createElement("img"),{width:30,height:30,src:bpImgUrls.dragOn}),hideDeadOn:null,hideDeadOff:null};window.onresize=f;document.body.addEventListener("dragover",c,false);document.body.addEventListener("drop",h,false);var p=document.createElement("whatever");p.id="dragonDrop";p.draggable="true";p.style.position="absolute";p.style.left="100px";p.style.top="100px";p.style.width="300px";p.style.background="rgb(20, 20, 20)";p.addEventListener("dragstart",l,false);document.body.appendChild(p);var d=function(e){if(e){bpOverlay.adventureFirstRun=true;bpOverlay.adventureTextMode=true;var t=document.getElementById("GameCanvas");t.parentNode.style.backgroundColor="rgb(20,20,20)";t.style.display="none";var n=document.createElement("DIV");n.id="adventure";n.className="adventureMeow";n.style.backgroundColor="rgb(20,20,20)";var r=document.createElement("P");r.id="adventurePINFO";r.className="adventureMeow";var s=0;var o=["a","b","c","d","e","f","g","h","i","j","l","m","n","o","p","q","r","s","t","u","v"];var u=200;for(i=0;i<channel.data.actors.length;i++){if(channel.data.actors[i].authId===window.app.user.authId){s=channel.data.actors[i].lives;o=channel.data.actors[i].lockedLetters;u=i}}if(u==200){var a=0}else if(bpOverlay.flips[u]>=bpOverlay.adventureLevels.length){var a=bpOverlay.adventureLevels.length-1}else{var a=bpOverlay.flips[u]}r.innerHTML=window.app.user.displayName+" : "+bpOverlay.adventureLevels[a];r.style.color="rgb(255, 255, 51)";var f="";for(i in o){f+=o[i].toUpperCase()}var l=document.createElement("DIV");l.id="adventureEXPINFO";l.className="adventureMeow";l.innerHTML="Experience needed: "+f;l.style.color="rgb(255,255,255)";n.appendChild(l);n.appendChild(r);var c=document.createElement("DIV");c.id="adventurePlayer";c.className="adventureMeow";c.style="position: relative";n.appendChild(c);var h=document.createElement("IMG");h.id="adventureAvatar";h.className="adventureMeow";if(typeof window.app.user.pictureURL==="undefined"){h.src="http://bombparty.sparklinlabs.com/images/AvatarPlaceholder.png"}else{h.src=window.app.user.pictureURL}h.style="position: relative; float: right";c.appendChild(h);var p=document.createElement("DIV");p.id="adventureBars";p.className="adventureMeow";p.style="position: relative; float: right;";c.appendChild(p);var d=document.createElement("DIV");d.id="adventureHealth";d.className="adventureMeow";d.style="position: absolute;";d.style.width=10+s*70+"px";p.appendChild(d);var v=document.createElement("DIV");v.id="adventureExp";v.className="adventureMeow";v.style="position: absolute;";v.style.width=10+(21-o.length)*10+"px";p.appendChild(v);var m=document.createElement("DIV");m.id="adventureTurns";m.className="adventureMeow";m.style="position: relative; float: right; color: #FFF";c.appendChild(m);var g=document.createElement("DIV");g.id="adventureMessages";g.className="adventureMeow";g.align="center";g.style="position: relative;";n.appendChild(g);t.parentNode.insertBefore(n,t);g.style.marginLeft="40px";g.style.marginTop="40px";g.style.clear="both";c.style.marginLeft="40px";c.style.marginTop="5px";c.style.overflow="hidden";r.style.marginLeft="40px";l.style.marginLeft="40px";l.style.marginTop="40px";h.style.height="76px";h.style.width="76px";h.style.float="left";p.style.marginLeft="10px";p.style.height="75px";p.style.width="400px";p.style.border="1px solid #141414";p.style.float="left";d.style.backgroundColor="rgb(255,255,0)";d.style.border="10px solid red";d.style.marginTop="8px";d.style.marginBottom="14px";v.style.backgroundColor="rgb(0,0,204)";v.style.border="10px solid blue";v.style.marginTop="14px";v.style.marginBottom="8px";m.style.marginLeft="20px";m.style.float="left"}else{bpOverlay.adventureTextMode=false;bpOverlay.adventureFirstRun=false;var y=document.getElementsByClassName("adventureMeow");for(i=0;i<y.length;i++){y[i].parentNode.removeChild(y[i])}var t=document.getElementById("GameCanvas");t.parentNode.style.backgroundColor="";t.style.display=""}};var v=function(e,t){if(bpOverlay.adventureTextMode){var n=document.getElementById("adventureMessages");var r=document.createElement("P");r.style.color=t;r.innerHTML=e;if(n.children.length>10){n.appendChild(r);n.removeChild(n.firstChild)}else{n.appendChild(r)}}};var m=[];var g=[];var y=[];var b;var w={"#cccccc":"statusText","#ffffff":"promptText","#a0a0a0":"wordText","#60aa60":"highlightedText","#404040":"bonusLetterText"};var E=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;var S=window.cancelAnimationFrame||window.mozCancelAnimationFrame;loadCustomTheme=function(e){if(e&&!bpOverlay.isThemed){bpOverlay.isThemed=true;if(e.images){for(var t in e.images){if(!e.images[t].src){console.log("Error: source is not defined for image "+t+". Will try to execute anyway")}n[t]=e.images[t].src;if(e.images[t].xOffset||e.images[t].yOffset){var i={x:0,y:0};if(e.images[t].xOffset){i.x=e.images[t].xOffset}if(e.images[t].yOffset){i.y=e.images[t].yOffset}r[t]=i}T(t)}}if(e.css){if(e.css.text){var s=document.createElement("style");s.id="customThemeStyle";s.appendChild(document.createTextNode(e.css.text));document.getElementsByTagName("head")[0].appendChild(s)}else if(e.css.src){var s=document.createElement("style");s.id="customThemeStyle";s.src=e.css.src;document.getElementsByTagName("head")[0].appendChild(s)}else{console.log("Error: css field declared but no valid css provided. Will try to execute anyway")}}if(e.particles){if(e.particles.images&&e.particles.images.length){for(t=0;t<e.particles.images.length;t++){var o=new Image;o.src=e.particles.images[t];y.push(o)}}else{console.log("Error: no particle images defined. Will try to execute anyway")}var u=document.getElementById("GameCanvas");var a=u.getContext("2d");var f=(new Date).getTime();if(e.particles.emitters&&e.particles.emitters.length){var l=e.particles.emitters;for(t=0;t<l.length;t++){var c=l[t];c.spawnParticle=function(){if(Math.random()<c.spawnRate[bpOverlay.particleSpawnRate]){var e=Math.random();var t=c.position.x*u.width;if(c.position.width){t+=Math.random()*c.position.width*u.width}var n=c.position.y*u.height;if(c.position.height){n+=Math.random()*c.position.height*u.height}var r;if(typeof c.velocity.x==="number"){r=c.velocity.x}else{r=c.velocity.x.min+(c.velocity.linkedToSize?e:Math.random())*(c.velocity.x.max-c.velocity.x.min)}var i;if(typeof c.velocity.y==="number"){i=c.velocity.y}else{i=c.velocity.y.min+(c.velocity.linkedToSize?e:Math.random())*(c.velocity.y.max-c.velocity.y.min)}var s;if(typeof c.size==="number"){s=c.size}else{s=c.size.min+e*(c.size.max-c.size.min)}var o;if(typeof c.rotation==="number"){o=c.rotation}else{o=c.rotation.min+(c.rotation.linkedToSize?e:Math.random())*(c.rotation.max-c.rotation.min)}var a;if(typeof c.angularVelocity==="number"){a=c.angularVelocity}else{a=c.angularVelocity.min+(c.angularVelocity.linkedToSize?e:Math.random())*(c.angularVelocity.max-c.angularVelocity.min)}if(c.gravity){var f=c.gravity.x;var l=c.gravity.y}else{var f=0;var l=0}g.push({imageId:Math.floor(Math.random()*y.length),position:{x:t,y:n},velocity:{x:r,y:i},size:s,rotation:o,angularVelocity:a,gravity:{x:f,y:l},alpha:1})}}}}else if(e.particles.emitters===[]||!e.particles.emitters){console.log("Error: Particles declared but no emitters defined. Will try to execute anyway")}particleAnimate=function(){var n=e.particles.emitters;for(t=0;t<n.length;t++){n[t].spawnParticle()}var r=(new Date).getTime();var i=Math.min((r-f)/1e3,1);f=r;a.setTransform(1,0,0,1,0,0);for(t=g.length-1;t>=0;t--){var s=g[t];var o=y[s.imageId];s.position.x+=s.velocity.x*i;s.position.y+=s.velocity.y*i;s.rotation+=s.angularVelocity*i;s.rotation%=Math.PI*2;s.velocity.x+=s.gravity.x*i;s.velocity.y+=s.gravity.y*i;if(Math.abs(s.position.x-u.width/2)<100&&Math.abs(s.position.y-u.height/2)<200||s.position.x+c/2>u.width-Math.min(100,u.height/11*2)){s.alpha=Math.max(.1,s.alpha-.05)}else if(s.alpha<1){s.alpha=Math.min(1,s.alpha+.05)}if(s.alpha<1){var l=a.globalAlpha;a.globalAlpha=s.alpha}var c=o.width*s.size;var h=o.height*s.size;a.translate(s.position.x,s.position.y);a.rotate(s.rotation);a.drawImage(o,-c/2,-h/2,c,h);a.rotate(-s.rotation);a.translate(-s.position.x,-s.position.y);if(s.alpha<1){a.globalAlpha=l}if(s.x<-.2*u.width||s.position.y<-.2*u.height||s.position.x>1.2*u.width||s.position.y>1.2*u.height){g.splice(t,1)}}b=E(particleAnimate)};particleAnimate()}if(e.textStyles){a.fillTextRedux=a.fillText;a.fillText=function(){var t=a.shadowColor;var n=a.shadowBlur;var r=a.fillStyle;var i=a.font;var s=i.split("px ");var o=s[0];var u=s[1];var f=e.textStyles[w[r]];if(f){if(f.color){a.fillStyle=f.color}if(f.shadow){a.shadowColor="#000";a.shadowBlur=10}var l=[o,u];if(w[r]==="wordText"||w[r]==="highlightedText"){if(o==="20"){if(f.majorFontSize){l[0]=f.majorFontSize}}else if(o==="14"){if(f.minorFontSize){l[0]=f.minorFontSize}}}else{if(f.fontSize){l[0]=f.fontSize}}if(f.fontFamily){l[1]=f.fontFamily}a.font=l.join("px ")}a.fillTextRedux.apply(this,arguments);a.font=i;a.fillStyle=r;a.shadowColor=t;a.shadowBlur=n};a.measureTextRedux=a.measureText;a.measureText=function(){var t=a.font;var n=a.fillStyle;var r=t.split("px ");var i=r[0];var s=r[1];var o=e.textStyles[w[n]];if(o){var u=[i,s];if(w[n]==="wordText"||w[n]==="highlightedText"){if(i==="20"){if(o.majorFontSize){u[0]=o.majorFontSize}}else if(i==="14"){if(o.minorFontSize){u[0]=o.minorFontSize}}}if(o.fontFamily){u[1]=o.fontFamily}a.font=u.join("px ")}var f=a.measureTextRedux.apply(this,arguments);a.font=t;return f}}for(var t in gameImages){T(t)}}else if(!e&&bpOverlay.isThemed){bpOverlay.isThemed=false;if(s=document.getElementById("customThemeStyle")){s.parentNode.removeChild(s)}if(b!==undefined){S(b);b=undefined}var a=document.getElementById("GameCanvas").getContext("2d");if(a.fillTextRedux){a.fillText=a.fillTextRedux}if(a.measureTextRedux){a.measureText=a.measureTextRedux}for(var t in gameImages){N(t)}y=[];g=[];n={};r={}}};var T=function(e){if(n[e]&&gameImages[e]){gameImages[e].src=n[e]}};var N=function(e){if(s[e]&&gameImages[e]){gameImages[e].src=s[e]}};var C=function(){if(bpOverlay.boxHasBeenCreated||bpOverlay.dragBoxHasBeenCreated){var e=document.getElementById("infoBox");var t=e.parentNode;t.removeChild(e);bpOverlay.boxHasBeenCreated=false;bpOverlay.dragBoxHasBeenCreated=false}bpOverlay.prevPlayerNames=bpOverlay.playerNames;bpOverlay.prevLostLives=bpOverlay.lostLives;bpOverlay.prevFlips=bpOverlay.flips;bpOverlay.prevUFlips=bpOverlay.uFlips;bpOverlay.prevTimeText=bpOverlay.timeText;bpOverlay.prevWordCount=bpOverlay.wordCount;bpOverlay.playerNames={};bpOverlay.playerAuthId={};bpOverlay.lostLives={};bpOverlay.flips={};bpOverlay.uFlips={};actors=channel.data.actors;for(i=0;i<actors.length;i++){bpOverlay.playerNames[i]=actors[i].displayName;bpOverlay.playerAuthId[actors[i].authId]=i;bpOverlay.flips[i]=0;bpOverlay.uFlips[i]=0;bpOverlay.lostLives[i]=0}bpOverlay.wordCount=0;bpOverlay.timeText="Elapsed time | 0:00";var n=new Date;bpOverlay.startTime=n.getTime();var e=document.createElement("DIV");e.id="infoBox";var r=document.createElement("H2");r.id="infoBoxTimer";r.align="center";r.style.color="rgb(200,200,200)";r.textContent=bpOverlay.timeText;e.appendChild(r);var s=document.createElement("H2");s.align="center";s.id="infoWordCounter";s.style.color="rgb(200,200,200)";s.textContent="Word Count: 0";e.appendChild(s);var o=document.createElement("hr");e.appendChild(o);var u=document.createElement("DIV");u.className="infoTableDiv";u.align="center";if(document.getElementById("containerSelect")){var a=document.getElementById("containerSelect");if(a.value==="fitToPlayers"){u.style.maxHeight="1000px"}else{u.style.maxHeight="100px"}}u.style.overflowY="auto";var f=document.createElement("table");u.appendChild(f);var l=document.createElement("tr");var c=document.createElement("td");var h=document.createElement("BUTTON");var p=document.createElement("DIV");p.className="headerButtonDiv";h.id="autoFocusButton";h.className="headerButton";h.title="Show/Hide dead players.";h.onclick=function(){bpOverlay.hideDead=!bpOverlay.hideDead;if(bpOverlay.hideDead){h.removeChild(bpOverlayImgs.hideDeadOff);h.appendChild(bpOverlayImgs.hideDeadOn);var e=document.getElementsByClassName("playerRow");for(i=0;i<e.length;i++){if(e[i].style.color=="rgb(102, 102, 102)"){e[i].style.display="none"}}}else{h.removeChild(bpOverlayImgs.hideDeadOn);h.appendChild(bpOverlayImgs.hideDeadOff);var t=document.getElementById("ChatLog");var n=bpOverlay.autoScroll||t.scrollTop==t.scrollHeight;var e=document.getElementsByClassName("playerRow");for(i=0;i<e.length;i++){if(e[i].style.display=="none"){e[i].style.display="table-row"}}var r=window.onresize;r();if(n){t.scrollTop=t.scrollHeight}}};if(bpOverlay.hideDead){h.appendChild(bpOverlayImgs.hideDeadOn)}else{h.appendChild(bpOverlayImgs.hideDeadOff)}p.appendChild(h);c.appendChild(p);l.appendChild(c);var d=document.createElement("td");d.textContent="Flips";d.style.color="rgb(200,200,200)";d.align="center";d.style.padding="2px";d.style.fontSize="11px";d.style.width="40px";d.title="Lives gained by using all the bonus letters.";l.appendChild(d);var v=document.createElement("td");v.textContent="U-Flips";v.style.color="rgb(200,200,200)";v.align="center";v.style.padding="2px";v.style.fontSize="11px";v.style.width="40px";v.title='Lives gained whilst already at 3 lives, making the "flip" unnecessary.';l.appendChild(v);var m=document.createElement("td");m.textContent="Deaths";m.style.color="rgb(200,200,200)";m.align="center";m.style.padding="2px";m.style.fontSize="11px";m.style.width="40px";m.title="Lives lost in this game.";l.appendChild(m);f.appendChild(l);for(i=0;i<actors.length;i++){var g=document.createElement("tr");g.id=i+" row";g.className="playerRow";if(actors[i].state=="dead"){g.style.color="#666";if(bpOverlay.hideDead){g.style.display="none"}}else{g.style.color="rgb(210,210,210)"}var y=document.createElement("td");var b=bpOverlay.playerNames[i];if(b.length>18){b=b.slice(0,15)+"..."}y.textContent=b;y.align="center";g.appendChild(y);var w=document.createElement("td");w.id=i+" flips";w.textContent="0";w.align="center";g.appendChild(w);var E=document.createElement("td");E.id=i+" uFlips";E.textContent="0";E.align="center";g.appendChild(E);var S=document.createElement("td");S.id=i+" lives";S.textContent="0";S.align="center";g.appendChild(S);f.appendChild(g)}e.appendChild(u);if(bpOverlay.dragonDrop){var x=document.getElementById("dragonDrop");x.appendChild(e);bpOverlay.dragBoxHasBeenCreated=true}else{var T=document.getElementById("Sidebar");T.insertBefore(e,T.firstChild);bpOverlay.boxHasBeenCreated=true}var N=window.onresize;N();if(bpOverlay.autoScroll){var C=document.getElementById("ChatLog");C.scrollTop=C.scrollHeight}};var k=function(e,t,n,r){var i=document.getElementById("overlaySettingsTable");var s=document.createElement("TR");i.appendChild(s);var o=document.createElement("TD");o.innerHTML=e;s.appendChild(o);var u=document.createElement("TD");s.appendChild(u);var a=document.createElement("SELECT");a.id=n;u.appendChild(a);for(x in t){var f=document.createElement("OPTION");f.textContent=t[x];f.value=x;a.appendChild(f)}a.onchange=r};var L=function(e,t,n,r,i,s){var o=document.createElement("BUTTON");var u=document.createElement("DIV");u.className="headerButtonDiv";var a=document.getElementsByTagName("header")[0];var f=a.lastChild;a.insertBefore(u,f);var l=document.createElement("img");l=e;var c=document.createElement("img");c=t;o.id=n;o.className="headerButton";o.title=r;o.onclick=s;if(i){o.appendChild(e);o.dataset.state=true}else{o.appendChild(t);o.dataset.state=false}u.appendChild(o)};var A=function(){if(channel.data.state==="playing"&&(bpOverlay.boxHasBeenCreated||bpOverlay.dragBoxHasBeenCreated)){var e=new Date;var t=Math.floor((e.getTime()-bpOverlay.startTime)/1e3);if(t%60<10){var n="0"}else{var n=""}bpOverlay.timeText="Elapsed time | "+Math.floor(t/60)+":"+n+""+t%60+"";document.getElementById("infoBoxTimer").textContent=bpOverlay.timeText}};var O=function(e){if(bpOverlay.twitchOn){if(window.hasOwnProperty("twitch_global")){for(i in twitch_global){e=e.replace(new RegExp("\\b"+i+"\\b","g"),'<img src="http:'+twitch_global[i].url+'" title="'+i+'" style="margin-bottom:-6px"></img>')}}if(window.hasOwnProperty("twitch_subscriber")){var t=[];var n;var r=/\b\w+:\w+\b/g;while(n=r.exec(e)){t.push(n[0])}toReplace={};for(i=0;i<t.length;i++){var s=t[i].split(":");var o=s[0].toLowerCase();var u=s[1];if(!toReplace[t[i]]){if(twitch_subscriber[o]){if(twitch_subscriber[o].emotes[u]){toReplace[o+":"+u]=twitch_subscriber[o].emotes[u]}}}}for(i in toReplace){e=e.replace(new RegExp(i,"g"),'<img src="http:'+toReplace[i]+'" title="'+i+'" style="margin-bottom:-6px"></img>')}}}if(bpOverlay.markupOn){e=e.replace(/&lt;(\/?[BISUbisu])&gt;/g,"<$1>")}return e};var M=function(){var e=o;e.drawImageRedux=e.drawImage;e.drawImage=function(){for(i=0;i<t.length;i++){if(arguments[0].src.toLowerCase().indexOf("/images/"+t[i].toLowerCase()+".png")!=-1){gameImages[t[i]]=arguments[0];s[t[i]]=arguments[0].src;if(bpOverlay.isThemed){T(t[i])}t.splice(i,1);break}}var n=false;for(var i in r){if(gameImages[i].src===arguments[0].src){n=r[i];e.translate(n.x,n.y);break}}var o=e.drawImageRedux.apply(this,arguments);if(n){e.translate(-n.x,-n.y)}return o};JST["nuclearnode/chatMessage"]=function(e){var t;var n=[];var r=e||{};return function(e,r){n.push((null==(t=e)?"":t)+':  <span class="Content">'+O(jade.escape(null==(t=r)?"":t))+"</span>")}.call(this,"author"in r?r.author:"undefined"!=typeof author?author:void 0,"text"in r?r.text:"undefined"!=typeof text?text:void 0),n.join("")};JST["nuclearnode/chatUser"]=function(e){var t,n=[],r=e||{};return function(e,r,i){var s=[];(function(){var t=e.serviceHandles;if("number"==typeof t.length)for(var n=0,i=t.length;i>n;n++){var o=t[n];null==o&&(o=r.t("nuclearnode:serviceHandlePlaceholder")),"guest"!=n&&s.push(r.t("nuclearnode:userHandleOnService",{handle:o,service:r.t("nuclearnode:loginServices."+n)}))}else{var i=0;for(var n in t){i++;var o=t[n];null==o&&(o=r.t("nuclearnode:serviceHandlePlaceholder")),"guest"!=n&&s.push(r.t("nuclearnode:userHandleOnService",{handle:o,service:r.t("nuclearnode:loginServices."+n)}))}}}).call(this),n.push("<span"+jade.attr("title",s.join(", "),!0,!1)+' class="User">'),""!=e.role&&n.push("<span"+jade.attr("title",r.t("nuclearnode:userRoles."+e.role),!0,!1)+jade.cls(["UserRole_"+e.role],[!0])+"></span> "),n.push(jade.escape(null==(t=e.displayName)?"":t)),n.push("</span>")}.call(this,"user"in r?r.user:"undefined"!=typeof user?user:void 0,"i18n"in r?r.i18n:"undefined"!=typeof i18n?i18n:void 0,"app"in r?r.app:"undefined"!=typeof app?app:void 0),n.join("")};var n=channel.appendToChat;channel.appendToChat=function(e,t){try{t=Autolinker.link(t,{className:"chatMessageLink"});if(e==="Info"&&t.indexOf('class="User"')===-1){t=O(t)}if(bpOverlay.autoScroll){var r=document.getElementById("ChatLog");r.scrollTop=r.scrollHeight}}finally{n(e,t)}};var a=channel.socket.listeners("setActivePlayerIndex").shift();channel.socket.on("setActivePlayerIndex",function(e){try{if(bpOverlay.firstRun){C();bpOverlay.alphapos=0;bpOverlay.firstRun=false;if(bpOverlay.adventureTextMode){document.getElementById("adventureMessages").innerHTML="";v(u.chooseText("newRound"),"rgb(10,200,150)")}bpOverlay.adventureFirstRun=true}v("break","rgb(20,20,20");if(bpOverlay.autoFocus||bpOverlay.adventureTextMode){if(bpOverlay.adventureTextMode){var t=0;var n=["a","b","c","d","e","f","g","h","i","j","l","m","n","o","p","q","r","s","t","u","v"];var r=200;for(i=0;i<channel.data.actors.length;i++){if(channel.data.actors[i].authId===window.app.user.authId){t=channel.data.actors[i].lives;n=channel.data.actors[i].lockedLetters;r=i}}if(r==200){var s=0}else if(bpOverlay.flips[r]>=bpOverlay.adventureLevels.length){var s=bpOverlay.adventureLevels.length-1}else{var s=bpOverlay.flips[r]}var o=document.getElementById("adventurePINFO");o.innerHTML=window.app.user.displayName+" : "+bpOverlay.adventureLevels[s];var f=document.getElementById("adventureEXPINFO");var l="";for(i in n){l+=n[i].toUpperCase()}f.innerHTML="Experience needed: "+l;var c=document.getElementById("adventureHealth");c.style.width=10+t*70+"px";var h=document.getElementById("adventureExp");h.style.width=10+(21-n.length)*10+"px"}if(bpOverlay.focusNext&&bpOverlay.autoFocus){setTimeout(function(){document.getElementById("ChatInputBox").focus()},400);bpOverlay.focusNext=false}if(!bpOverlay.adventureFirstRun){if(channel.data.actors[e].authId===window.app.user.authId){if(bpOverlay.autoFocus){bpOverlay.focusNext=true}v(u.chooseText("userTurn",channel.data.wordRoot),"rgb(90, 250, 0)")}else{v(u.chooseText("playerTurn",channel.data.actors[e].displayName,channel.data.wordRoot),"rgb(255, 165, 0)")}}}}finally{a(e);if(bpOverlay.adventureFirstRun){bpOverlay.adventureFirstRun=false;setTimeout(function(){if(channel.data.actors[e].authId===window.app.user.authId){if(bpOverlay.autoFocus){bpOverlay.focusNext=true}v(u.chooseText("userTurn",channel.data.wordRoot),"rgb(90, 250, 0)")}else{v(u.chooseText("playerTurn",channel.data.actors[e].displayName,channel.data.wordRoot),"rgb(255, 165, 0)")}},100)}if(bpOverlay.adventureTextMode){setTimeout(function(){for(i=0;i<channel.data.actors.length;i++){var e=document.getElementById("adventureTurns");var t=channel.data.activePlayerIndex;if(t==i){if(typeof channel.data.actors[t].pictureURL==="undefined"){var n="http://bombparty.sparklinlabs.com/images/AvatarPlaceholder.png"}else{var n=channel.data.actors[t].pictureURL}var r=21-channel.data.actors[t].lockedLetters.length;var s="";for(j=0;j<channel.data.actors[t].lives;j++){s+="♥"}e.innerHTML="<img src=' "+n+"' height='70px' width='70px' style='float:left; margin-right: 10px'></img><div style='float:right;'><p style='color: #DFA'>"+channel.data.actors[i].displayName+"<p style='color: orange'>Lives: <span style='color: red'>"+s+"</span></p><p style='color: #A746C7'>EXP: <span style='color: #7D8ADB'>"+r+"/21</div>"}}},100)}}});var f=channel.socket.listeners("winWord").shift();channel.socket.on("winWord",function(e){try{var t=channel.data.actorsByAuthId[e.playerAuthId];var n=bpOverlay.playerAuthId[e.playerAuthId];var r=t.lockedLetters.slice();var s=t.lastWord.toLowerCase();var o=r.length;for(i=0;i<s.length;i++){var a;if((a=r.indexOf(s[i]))!=-1){r.splice(a,1)}}var l=o-r.length;var c=r.length===0;if(c){bpOverlay.flips[n]+=1;if(bpOverlay.boxHasBeenCreated||bpOverlay.dragBoxHasBeenCreated){document.getElementById(n+" flips").textContent=bpOverlay.flips[n]}if(t.lives===3){bpOverlay.uFlips[n]+=1;if(bpOverlay.boxHasBeenCreated||bpOverlay.dragBoxHasBeenCreated){document.getElementById(n+" uFlips").textContent=bpOverlay.uFlips[n]}}if(bpOverlay.flips[n]>=bpOverlay.adventureLevels.length){var h=bpOverlay.adventureLevels.length-1}else{var h=bpOverlay.flips[n]}if(channel.data.actors[n].displayName===window.app.user.displayName){v(u.chooseText("userLevelUp",bpOverlay.adventureLevels[h]),"rgb(200, 200, 0")}else{v(u.chooseText("levelUp",channel.data.actors[n].displayName,bpOverlay.adventureLevels[h]),"rgb(200, 200, 0)")}}else{if(channel.data.actors[n].displayName===window.app.user.displayName){v(u.chooseText("userWinWord",t.lastWord.toUpperCase(),l),"rgb(250, 0, 250)")}else{v(u.chooseText("winWord",t.displayName,t.lastWord.toUpperCase(),l),"rgb(250, 0, 250)")}}bpOverlay.wordCount+=1;if(bpOverlay.boxHasBeenCreated||bpOverlay.dragBoxHasBeenCreated){document.getElementById("infoWordCounter").textContent="Word Count: "+bpOverlay.wordCount}if(channel.data.actors[n].displayName===window.app.user.displayName){if(bpOverlay.alphabet.length<=bpOverlay.alphapos){bpOverlay.alphapos=0}else{bpOverlay.alphapos++}}}finally{f(e)}});var l=channel.socket.listeners("setPlayerLives").shift();channel.socket.on("setPlayerLives",function(e){try{if(e.playerAuthId===window.app.user.authId){v(u.chooseText("userLostLife"),"rgb(255,20,10)")}else{v(u.chooseText("lostLife",channel.data.actorsByAuthId[e.playerAuthId].displayName),"rgb(255,20,10)")}var t=channel.data.actorsByAuthId[e.playerAuthId];var n=bpOverlay.playerAuthId[e.playerAuthId];if(t.lives>e.lives){bpOverlay.lostLives[n]+=1;if(bpOverlay.boxHasBeenCreated||bpOverlay.dragBoxHasBeenCreated){document.getElementById(n+" lives").textContent=bpOverlay.lostLives[n]}}}finally{l(e)}});var c=channel.socket.listeners("setPlayerState").shift();channel.socket.on("setPlayerState",function(e){try{if(bpOverlay.boxHasBeenCreated||bpOverlay.dragBoxHasBeenCreated){if(e.state=="dead"){var t=bpOverlay.playerAuthId[e.playerAuthId];var n=document.getElementById(t+" row");n.style.color="#666";if(bpOverlay.hideDead){n.style.display="none"}if(e.playerAuthId===window.app.user.authId){v(u.chooseText("userDeath",channel.data.actorsByAuthId[e.playerAuthId].displayName),"rgb(255,255,255")}else{v(u.chooseText("death",channel.data.actorsByAuthId[e.playerAuthId].displayName),"rgb(255,255,255")}}}}finally{c(e)}});var h=channel.socket.listeners("endGame").shift();channel.socket.on("endGame",function(e){try{bpOverlay.firstRun=true;if(bpOverlay.adventureTextMode){document.getElementById("adventureMessages").innerHTML="";document.getElementById("adventureTurns").innerHTML="";v(u.chooseText("endRound",channel.data.wordRoot.toUpperCase()),"rgb(204, 255, 204)")}if(bpOverlay.autoFocus){if(bpOverlay.focusNext){setTimeout(function(){document.getElementById("ChatInputBox").focus()},400);bpOverlay.focusNext=false}}A()}finally{h(e);setTimeout(function(){v(u.chooseText("winner",channel.data.lastWinner),"rgb(24, 24, 255)")},100)}});var p=function(){var e=document.getElementsByClassName("ChannelUsers")[0];var t="Players:";for(var n in channel.data.users){t+="\n"+channel.data.users[n].displayName}e.title=t;if(!document.getElementById("PlayerList")){var r=document.getElementById("overlaySettingsTab");var i=document.createElement("DIV");i.id="PlayerList";r.appendChild(i)}else{var i=document.getElementById("PlayerList")}var s="";for(var n in channel.data.users){var o=channel.data.users[n];var u=o.serviceHandles;var a=[];var f=i18n;var l=app;var c=[];(function(){var e=o.serviceHandles;if("number"==typeof e.length)for(var t=0,n=e.length;n>t;t++){var r=e[t];null==r&&(r=f.t("nuclearnode:serviceHandlePlaceholder")),"guest"!=t&&c.push(f.t("nuclearnode:userHandleOnService",{handle:r,service:f.t("nuclearnode:loginServices."+t)}))}else{var n=0;for(var t in e){n++;var r=e[t];null==r&&(r=f.t("nuclearnode:serviceHandlePlaceholder")),"guest"!=t&&c.push(f.t("nuclearnode:userHandleOnService",{handle:r,service:f.t("nuclearnode:loginServices."+t)}))}}}).call(this),a.push("<span"+jade.attr("title",c.join(", "),!0,!1)+' class="User">'),""!=o.role&&a.push("<span"+jade.attr("title",f.t("nuclearnode:userRoles."+o.role),!0,!1)+jade.cls(["UserRole_"+o.role],[!0])+"></span> "),a.push(jade.escape(null==(u=o.displayName)?"":u)),-1!=["host","hubAdministrator","moderator"].indexOf(l.user.role)&&(a.push('<span class="Actions"><button'+jade.attr("data-auth-id",o.authId,!0,!1)+jade.attr("data-display-name",o.displayName,!0,!1)+' class="BanUser">'+jade.escape(null==(u=f.t("nuclearnode:chat.ban"))?"":u)+"</button>"),("host"==l.user.role||"hubAdministrator"==l.user.role)&&a.push("<button"+jade.attr("data-auth-id",o.authId,!0,!1)+jade.attr("data-display-name",o.displayName,!0,!1)+' class="ModUser">'+jade.escape(null==(u=f.t("nuclearnode:chat.mod"))?"":u)+"</button>"),a.push("</span>")),a.push("</span>");s+=a.join("");s+="<br />"}i.innerHTML=s};channel.socket.on("addUser",p);channel.socket.on("removeUser",p);channel.socket.on("setUserRole",p);p()};var _=function(){function a(){for(i=0;i<=2;i++){document.getElementById("SidebarTabButtons").children[i].setAttribute("class","")}for(i=0;i<=2;i++){document.getElementById("SidebarTabs").children[i].setAttribute("class","")}document.getElementById("overlaySettingsButton").setAttribute("class","Active");document.getElementById("overlaySettingsTab").setAttribute("class","Active")}var e=document.createElement("style");e.appendChild(document.createTextNode('.headerButtonDiv {  display: -webkit-box;  display: -moz-box;  display: -webkit-flex;  display: -ms-flexbox;  display: box;  display: flex;  opacity: 0.3;  -ms-filter: "progid:DXImageTransform.Microsoft.Alpha(Opacity=30)";  filter: alpha(opacity=30);} .headerButtonDiv:hover {  opacity: 1;  -ms-filter: none;  filter: none;} button.headerButton {  border: none;  background: none;  cursor: pointer;  opacity: 0.5;  -ms-filter: "progid:DXImageTransform.Microsoft.Alpha(Opacity=50)";  filter: alpha(opacity=50);  display: -webkit-box;  display: -moz-box;  display: -webkit-flex;  display: -ms-flexbox;  display: box;  display: flex;} button.headerButton:hover {  opacity: 0.8;  -ms-filter: "progid:DXImageTransform.Microsoft.Alpha(Opacity=80)";  filter: alpha(opacity=80);} button.headerButton:active {  opacity: 1;  -ms-filter: none;  filter: none;} .infoTableDiv::-webkit-scrollbar { width: 15px; height: 15px; } .infoTableDiv::-webkit-scrollbar-button { height: 0px; width: 0px; } .infoTableDiv::-webkit-scrollbar-track { background-color: rgba(0,0,0,0.05); } .infoTableDiv::-webkit-scrollbar-thumb { background-color: rgba(255,255,255,0.1); border: 3px solid transparent; -webkit-border-radius: 6px; border-radius: 6px; -webkit-background-clip: content; -moz-background-clip: content; background-clip: content-box; } .infoTableDiv::-webkit-scrollbar-thumb:hover { background-color: rgba(255,255,255,0.15); } .infoTableDiv::-webkit-scrollbar-corner { background-color: rgba(255,255,255,0.1); }#overlaySettingsTab{text-align:left;overflow-y:auto}#overlaySettingsTab h2{padding:.5em .5em 0;opacity:.5;-ms-filter:"alpha(Opacity=50)";filter:alpha(opacity=50)}#overlaySettingsTab table{width:100%;padding:.5em}#overlaySettingsTab table tr td:nth-child(1){width:40%}#overlaySettingsTab table tr td:nth-child(2){width:60%}#overlaySettingsTab table button:not(.UnbanUser),#overlaySettingsTab table input,#overlaySettingsTab table select,#overlaySettingsTab table textarea{width:100%;background:#444;border:none;padding:.25em;color:#fff;font:inherit}#overlaySettingsTab table textarea{resize:vertical;min-height:3em}#overlaySettingsTab table ul{list-style:none}#overlaySettingsTab .User .UserRole_hubAdministrator:before{content:\'[★]\';cursor:default;color:#c63}#overlaySettingsTab .User .UserRole_host:before{content:\'★\';cursor:default;color:#dc8}#overlaySettingsTab .User .UserRole_administrator:before{content:\'☆\';cursor:default;color:#dc8}#overlaySettingsTab .User .UserRole_moderator:before{content:\'●\';cursor:default;color:#346192}#overlaySettingsTab .Actions button{border:none;background:0 0;cursor:pointer;margin:0 .25em;outline:0;font-weight:400;font-size:smaller;opacity:.8;-ms-filter:"alpha(Opacity=80)";filter:alpha(opacity=80)}#overlaySettingsTab .Actions button.BanUser{color:#a00}#overlaySettingsTab .Actions button.ModUser,#overlaySettingsTab .Actions button.UnmodUser{color:#2a3}#overlaySettingsTab .Actions button:hover{opacity:1;-ms-filter:none;filter:none}#overlaySettingsTab .Actions button:active{background:rgba(255,0,0,.2)}'));document.getElementsByTagName("head")[0].appendChild(e);var t=document.createElement("img");t.width=15;t.height=15;t.src=bpImgUrls.hideDeadOn;bpOverlayImgs.hideDeadOn=t;var n=document.createElement("img");n.width=15;n.height=15;n.src=bpImgUrls.hideDeadOff;bpOverlayImgs.hideDeadOff=n;L(bpOverlayImgs.on,bpOverlayImgs.off,"chatDownButton","Automatically scroll the chat down whenever there is a new message.",true,function(){bpOverlay.autoScroll=!bpOverlay.autoScroll;if(bpOverlay.autoScroll){document.getElementById("chatDownButton").removeChild(bpOverlayImgs.off);document.getElementById("chatDownButton").appendChild(bpOverlayImgs.on);document.getElementById("chatDownButton").dataset.state=true}else{document.getElementById("chatDownButton").removeChild(bpOverlayImgs.on);document.getElementById("chatDownButton").appendChild(bpOverlayImgs.off);document.getElementById("chatDownButton").dataset.state=false}});L(bpOverlayImgs.autoFocusOn,bpOverlayImgs.autoFocusOff,"autoFocusButton","Automatically focus the chat box after your turn.",true,function(){bpOverlay.autoFocus=!bpOverlay.autoFocus;if(bpOverlay.autoFocus){document.getElementById("autoFocusButton").removeChild(bpOverlayImgs.autoFocusOff);document.getElementById("autoFocusButton").appendChild(bpOverlayImgs.autoFocusOn);document.getElementById("autoFocusButton").dataset.state=true}else{document.getElementById("autoFocusButton").removeChild(bpOverlayImgs.autoFocusOn);document.getElementById("autoFocusButton").appendChild(bpOverlayImgs.autoFocusOff);document.getElementById("autoFocusButton").dataset.state=false}});L(bpOverlayImgs.dragOn,bpOverlayImgs.dragOff,"dragButton","Have the info be in a draggable container instead",false,function(){if(bpOverlay.boxHasBeenCreated||bpOverlay.dragBoxHasBeenCreated){bpOverlay.dragonDrop=!bpOverlay.dragonDrop;var e=document.getElementById("dragButton");var t=document.getElementById("Sidebar");var n=document.getElementById("infoBox");var r=document.getElementById("dragonDrop");if(bpOverlay.dragonDrop){t.removeChild(n);r.appendChild(n);e.removeChild(bpOverlayImgs.dragOff);e.appendChild(bpOverlayImgs.dragOn);bpOverlay.dragBoxHasBeenCreated=true;bpOverlay.boxHasBeenCreated=false;e.dataset.state=true}else{r.removeChild(n);t.insertBefore(n,t.firstChild);bpOverlay.dragBoxHasBeenCreated=false;bpOverlay.boxHasBeenCreated=true;e.removeChild(bpOverlayImgs.dragOn);e.appendChild(bpOverlayImgs.dragOff);e.dataset.state=false}}else{bpOverlay.dragonDrop=!bpOverlay.dragonDrop;var e=document.getElementById("dragButton");if(bpOverlay.dragonDrop){e.removeChild(bpOverlayImgs.dragOff);e.appendChild(bpOverlayImgs.dragOn);e.dataset.state=true}else{e.removeChild(bpOverlayImgs.dragOn);e.appendChild(bpOverlayImgs.dragOff);e.dataset.state=false}}});var r=document.getElementById("SidebarTabButtons");var s=document.getElementById("SidebarTabs");var o=s.children[1].cloneNode(true);o.id="overlaySettingsTab";o.setAttribute("class","");o.innerHTML="";var u=r.children[0].cloneNode(true);u.id="overlaySettingsButton";u.setAttribute("class","");u.innerHTML="BpOS";u.title="Bompbarty Overlay Settings";r.appendChild(u);s.appendChild(o);u.onclick=a;var f=document.createElement("H2");f.textContent="Overlay Settings";var l=document.getElementById("overlaySettingsTab");l.appendChild(f);var c=document.createElement("TABLE");c.id="overlaySettingsTable";l.appendChild(c);var h=document.createElement("H2");h.textContent="Current Players";l.appendChild(h);var p=document.createElement("DIV");p.id="PlayerList";p.style.marginLeft="8px";l.appendChild(p);var v=document.createElement("H2");v.textContent="Credits";l.appendChild(v);var m=document.createElement("TABLE");m.id="creditsTable";m.innerHTML='				<tr><td>Code Monkey</td><td>MrInanimated</td></tr>				<tr><td>Code Master</td><td>Skandalabrandur</td></tr>				<tr><td>Autolinker</td><td><a href="https://github.com/gregjacobs/Autolinker.js">Autolinker.js</a></td></tr>				<tr><td>Twitch Emotes</td><td><a href="http://twitchemotes.com/">twitchemotes.com</a></td></tr>';l.appendChild(m);var g=document.createElement("DIV");g.textContent="With thanks to the English BombParty community";g.style.marginLeft="8px";l.appendChild(g);k("Container Size",{compact:"Compact size",fitToPlayers:"Fit To Players"},"containerSelect",function(){var e=document.getElementsByClassName("infoTableDiv")[0];var t=document.getElementById("containerSelect");if(e&&t){if(t.value==="compact"){e.style.maxHeight="100px"}else if(t.value==="fitToPlayers"){e.style.maxHeight="1000px";var n=window.onresize;n()}else{}}});k("Twitch Emotes",{on:"On",off:"Off"},"twitchEmoteSelect",function(){var e=document.getElementById("twitchEmoteSelect");if(e.value==="on"){bpOverlay.twitchOn=true}else if(e.value==="off"){bpOverlay.twitchOff=false}else{}});k("Text Adventure<sup>BETA</sup>",{off:"Off",on:"On"},"adventureSetting",function(){var e=document.getElementById("adventureSetting");if(e.value==="on"){d(true)}else if(e.value==="off"){d(false)}else{d(false)}});k("Hard modes",{none:"None",rev:"Reverse",jqv:"J/Q/V",az:"Alphabet",xz:"X/Z"},"hardModes",function(){var e=document.getElementById("hardModes");if(e.value==="rev"){var t=document.getElementById("WordInputBox");var n=function(){document.getElementById("WordInputBox").value=document.getElementById("WordInputBox").value.split("").reverse().join("")};t.onchange=n}else if(e.value==="jqv"){var t=document.getElementById("WordInputBox");var n=function(){var e=document.getElementById("WordInputBox").value.toLowerCase();if(!(e.indexOf("q")>-1||e.indexOf("v")>-1||e.indexOf("j")>-1)){document.getElementById("WordInputBox").value="This word didn't contain j, v nor q!"}};t.onchange=n}else if(e.value==="az"){bpOverlay.alphapos=0;var t=document.getElementById("WordInputBox");var n=function(){var e=document.getElementById("WordInputBox").value.toLowerCase();if(!(e[0]===bpOverlay.alphabet[bpOverlay.alphapos])){document.getElementById("WordInputBox").value="You are on letter "+bpOverlay.alphabet[bpOverlay.alphapos]+" kappa!"}};t.onchange=n}else if(e.value==="xz"){var t=document.getElementById("WordInputBox");var n=function(){var e=document.getElementById("WordInputBox").value.toLowerCase();if(!(e.indexOf("x")>-1||e.indexOf("z")>-1)){document.getElementById("WordInputBox").value="This word didn't contain x nor z!"}};t.onchange=n}else{document.getElementById("WordInputBox").onchange=""}});k("Theme<sup>BETA</sup>",{none:"None","https://raw.githubusercontent.com/MrInanimated/bp-overlay/master/themes/xmas/xmas.json":"Christmas",custom:"Custom"},"themeSelect",function(){var e=document.getElementById("themeSelect");if(e.value==="none"){loadCustomTheme(false);document.getElementById("customThemeRow").style.display="none"}else if(e.value==="custom"){document.getElementById("customThemeRow").style.display=""}else{document.getElementById("customThemeRow").style.display="none"}});(function(){var e=document.getElementById("overlaySettingsTable");var t=document.createElement("TR");t.id="customThemeRow";t.style.display="none";e.appendChild(t);var n=document.createElement("TD");n.innerHTML="Custom Theme";t.appendChild(n);var r=document.createElement("TD");t.appendChild(r);var i=document.createElement("INPUT");i.id="customThemeInput";r.appendChild(i)})();k("Particles",{high:"High",low:"Low",off:"Off"},"particleSelect",function(){var e=document.getElementById("particleSelect");if(e.value==="high"){bpOverlay.particleSpawnRate="high"}else if(e.value==="low"){bpOverlay.particleSpawnRate="low"}else{bpOverlay.particleSpawnRate="none"}});M()};_();setInterval(A,1e3);channel.appendToChat("Info","New Update! (2014-12-30):<br />Custom Theme loading!")};e()}};var s=document.createElement("script");s.setAttribute("type","application/javascript");s.textContent="("+source+")();";document.body.appendChild(s);document.body.removeChild(s);var validateThemeObj=function(e){var t=true;if(typeof e.images==="object"){for(var n in e.images){if(typeof e.images[n]!=="object"){console.log("Error: image "+n+" is not an object.");t=false}else{if(typeof e.images[n].src!=="string"){console.log("Error: invalid src provided in image "+n+".");t=false}if(typeof e.images[n].xOffset!=="number"&&typeof e.images[n].xOffset!=="undefined"){console.log("Error: invalid xOffset in image "+n+".");t=false}if(typeof e.images[n].yOffset!=="number"&&typeof e.images[n].yOffset!=="undefined"){console.log("Error: invalid yOffset in image "+n+".");t=false}}}}else if(typeof e.images!=="undefined"){console.log("Error: images is not an object.");t=false}if(typeof e.css==="object"){if(e.css.text){if(typeof e.css.text!=="string"){console.log("Error: invalid css.text provided");t=false}}else if(e.css.src){if(typeof e.css.src!=="string"){console.log("Error: invalid css source provided");t=false}}else{console.log("Error: css field declared, but no css provided");t=false}}else if(typeof e.css!=="undefined"){console.log("Error: css is not an object.");t=false}var r=function(e){if(typeof e==="object"){if(typeof e.min!=="number"){return false}if(typeof e.max!=="number"){return false}}else if(typeof e!=="number"){return false}return true};if(typeof e.particles==="object"){if(Object.prototype.toString.call(e.particles.emitters)==="[object Array]"){for(n=0;n<e.particles.emitters.length;n++){var i=e.particles.emitters[n];if(typeof i.position==="object"){if(typeof i.position.x!=="number"){console.log("Error: particle.emitters["+n+"].position.x is not a number");t=false}if(typeof i.position.y!=="number"){console.log("Error: particle.emitters["+n+"].position.y is not a number");t=false}if(typeof i.position.width!=="undefined"&&typeof i.position.width!=="number"){console.log("Error: particle.emitters["+n+"].position.width is not a number");t=false}if(typeof i.position.height!=="undefined"&&typeof i.position.height!=="number"){console.log("Error: particle.emitters["+n+"].position.height is not a number");t=false}}else{console.log("Error: particles.emitters["+n+"].position is not an object");t=false}if(typeof i.velocity==="object"){if(!r(i.velocity.x)){console.log("Error: particles.emitters["+n+"].velocity.x is invalid");t=false}if(!r(i.velocity.y)){console.log("Error: particles.emitters["+n+"].velocity.y is invalid");t=false}}else{console.log("Error: particles.emitters["+n+"].velocity is not an object");t=false}if(!r(i.size)){console.log("Error: particles.emitters["+n+"].size is invalid");t=false}if(!r(i.rotation)){console.log("Error: particles.emitters["+n+"].rotation is invalid");t=false}if(!r(i.angularVelocity)){console.log("Error: particles.emitters["+n+"].angularVelocity is invalid");t=false}if(typeof i.spawnRate==="object"){if(typeof i.spawnRate.high!=="number"){console.log("Error: particles.emitters["+n+"].spawnRate.high is invalid");t=false}if(typeof i.spawnRate.low!=="number"){console.log("Error: particles.emitters["+n+"].spawnRate.low is invalid");t=false}}else{console.log("Error: particle.emitters["+n+"].spawnRate is not an object");t=false}if(typeof i.gravity==="object"){if(!r(i.gravity.x)){console.log("Error: particles.emitters["+n+"].gravity.x is invalid");t=false}if(!r(i.gravity.y)){console.log("Error: particles.emitters["+n+"].gravity.y is invalid");t=false}}else{console.log("Error: particles.emitters["+n+"].gravity is not an object");t=false}}}else{console.log("Error: particles.emitters is not an array");t=false}if(Object.prototype.toString.call(e.particles.images)==="[object Array]"){for(n=0;n<e.particles.images.length;n++){if(typeof e.particles.images[n]!=="string"){console.log("Error: particles.images["+n+"] is not a string");t=false}}}}else if(typeof e.particles!=="undefined"){console.log("Error: particles is not an object");t=false}var s=function(e){if(typeof e==="object"){if(typeof e.color!=="undefined"){if(typeof e.color!=="string"){return false}}if(typeof e.fontFamily!=="undefined"){if(typeof e.fontFamily!=="string"){return false}}if(typeof e.fontSize!=="undefined"){if(typeof e.fontSize!=="number"){return false}}if(typeof e.majorFontSize!=="undefined"){if(typeof e.majorFontSize!=="number"){return false}}if(typeof e.minorFontSize!=="undefined"){if(typeof e.minorFontSize!=="number"){return false}}}else if(typeof (e!=="undefined")){return false}return true};var o=["statusText","promptText","wordText","highlightedText","bonusLetterText"];if(typeof e.textStyles==="object"){for(n=0;n<o.length;n++){if(!s(e.textStyles[o[n]])){console.log("Error: textStyles."+o[n]+" is invalid or has some invalid parameters.");t=false}}}else if(typeof e.textStyles!=="undefined"){console.log("Error: textStyles is not an object.");t=false}return t};var json_parse=function(){"use strict";var e,t,n={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"	"},r,i=function(t){throw{name:"SyntaxError",message:t,at:e,text:r}},s=function(n){if(n&&n!==t){i("Expected '"+n+"' instead of '"+t+"'")}t=r.charAt(e);e+=1;return t},o=function(){var e,n="";if(t==="-"){n="-";s("-")}while(t>="0"&&t<="9"){n+=t;s()}if(t==="."){n+=".";while(s()&&t>="0"&&t<="9"){n+=t}}if(t==="e"||t==="E"){n+=t;s();if(t==="-"||t==="+"){n+=t;s()}while(t>="0"&&t<="9"){n+=t;s()}}e=+n;if(!isFinite(e)){i("Bad number")}else{return e}},u=function(){var e,r,o="",u;if(t==='"'){while(s()){if(t==='"'){s();return o}if(t==="\\"){s();if(t==="u"){u=0;for(r=0;r<4;r+=1){e=parseInt(s(),16);if(!isFinite(e)){break}u=u*16+e}o+=String.fromCharCode(u)}else if(typeof n[t]==="string"){o+=n[t]}else{break}}else{o+=t}}}i("Bad string")},a=function(){while(t&&t<=" "){s()}},f=function(){switch(t){case"t":s("t");s("r");s("u");s("e");return true;case"f":s("f");s("a");s("l");s("s");s("e");return false;case"n":s("n");s("u");s("l");s("l");return null}i("Unexpected '"+t+"'")},l,c=function(){var e=[];if(t==="["){s("[");a();if(t==="]"){s("]");return e}while(t){e.push(l());a();if(t==="]"){s("]");return e}s(",");a()}}i("Bad array")},h=function(){var e,n={};if(t==="{"){s("{");a();if(t==="}"){s("}");return n}while(t){e=u();a();s(":");if(Object.hasOwnProperty.call(n,e)){i('Duplicate key "'+e+'"')}n[e]=l();a();if(t==="}"){s("}");return n}s(",");a()}}i("Bad object")};l=function(){a();switch(t){case"{":return h();case"[":return c();case'"':return u();case"-":return o();default:return t>="0"&&t<="9"?o():f()}};return function(n,s){var o;r=n;e=0;t=" ";o=l();a();if(t){i("Syntax error")}return typeof s==="function"?function u(e,t){var n,r,i=e[t];if(i&&typeof i==="object"){for(n in i){if(Object.prototype.hasOwnProperty.call(i,n)){r=u(i,n);if(r!==undefined){i[n]=r}else{delete i[n]}}}}return s.call(e,t,i)}({"":o},""):o}}();var loadAndApplyTheme=function(e){GM_xmlhttpRequest({method:"GET",url:e,onload:function(e){try{var t=json_parse(e.responseText)}catch(n){alert("Invalid JSON.");console.log(n);return}if(validateThemeObj(t)){var r=document.createElement("script");r.setAttribute("type","application/javascript");r.textContent="loadCustomTheme(false); loadCustomTheme("+e.responseText+")";document.body.appendChild(r);document.body.removeChild(r)}else{alert("Invalid theme specified. Check the console for what is invalid.")}},onerror:function(t){alert("Error loading "+e)}})};var attachToSettings=function(){if(!(document.getElementById("containerSelect")&&document.getElementById("twitchEmoteSelect")&&document.getElementById("adventureSetting")&&document.getElementById("themeSelect")&&document.getElementById("customThemeInput")&&document.getElementById("particleSelect")&&document.getElementById("chatDownButton")&&document.getElementById("autoFocusButton")&&document.getElementById("dragButton"))){setTimeout(attachToSettings,1e3)}else{var e=document.getElementById("containerSelect");var t=document.getElementById("twitchEmoteSelect");var n=document.getElementById("adventureSetting");var r=document.getElementById("themeSelect");var i=document.getElementById("customThemeInput");var s=document.getElementById("particleSelect");var o=document.getElementById("chatDownButton");var u=document.getElementById("autoFocusButton");var a=document.getElementById("dragButton");var f=function(e,t,n){if(GM_getValue(t,n)!==e.value){e.value=GM_getValue(t,n);var r=new Event("change");e.dispatchEvent(r)}};var l=function(e,t,n){if(GM_getValue(t,n)!==e.dataset.state){var r=new MouseEvent("click");e.dispatchEvent(r)}};f(e,"containerState","compact");f(t,"twitchEmoteState","on");f(n,"adventureState","off");f(s,"particleState","high");l(o,"chatDownState","true");l(u,"autoFocusState","true");l(a,"dragState","false");e.addEventListener("change",function(){setTimeout(function(){GM_setValue("containerState",e.value)},100)});t.addEventListener("change",function(){setTimeout(function(){GM_setValue("twitchEmoteState",t.value)},100)});n.addEventListener("change",function(){setTimeout(function(){GM_setValue("adventureState",n.value)},100)});s.addEventListener("change",function(){setTimeout(function(){GM_setValue("particleState",s.value)},100)});o.addEventListener("click",function(){setTimeout(function(){GM_setValue("chatDownState",o.dataset.state)},100)});u.addEventListener("click",function(){setTimeout(function(){GM_setValue("autoFocusState",u.dataset.state)},100)});a.addEventListener("click",function(){setTimeout(function(){GM_setValue("dragState",a.dataset.state)},100)});r.addEventListener("change",function(){if(r.value!=="none"&&r.value!=="custom"){loadAndApplyTheme(r.value)}});i.addEventListener("keypress",function(e){if(e.keyCode===13){loadAndApplyTheme(i.value)}})}};attachToSettings()